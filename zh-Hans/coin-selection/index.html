<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference-client/coin-selection" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Coin Selection | Chia Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.chia.net/zh-Hans/img/og-chia.png"><meta data-rh="true" name="twitter:image" content="https://docs.chia.net/zh-Hans/img/og-chia.png"><meta data-rh="true" property="og:url" content="https://docs.chia.net/zh-Hans/coin-selection/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Coin Selection | Chia Documentation"><meta data-rh="true" name="description" content="Chia uses the Coin Set model of accounting, under which everything is a coin. When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.) When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.)"><meta data-rh="true" property="og:description" content="Chia uses the Coin Set model of accounting, under which everything is a coin. When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.) When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.)"><link data-rh="true" rel="icon" href="/zh-Hans/svg/chia-leaf-green.svg"><link data-rh="true" rel="canonical" href="https://docs.chia.net/zh-Hans/coin-selection/"><link data-rh="true" rel="alternate" href="https://docs.chia.net/coin-selection/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.chia.net/zh-Hans/coin-selection/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://docs.chia.net/coin-selection/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/zh-Hans/assets/css/styles.31a11478.css">
<script src="/zh-Hans/assets/js/runtime~main.ce19acc6.js" defer="defer"></script>
<script src="/zh-Hans/assets/js/main.1863f696.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-Hans/"><div class="navbar__logo"><img src="/zh-Hans/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh-Hans/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Chia Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-Hans/docs-home/">Docs</a><a class="navbar__item navbar__link" href="/zh-Hans/dev-guides-home/">Dev Guides</a><a class="navbar__item navbar__link" href="/zh-Hans/academy-home/">Chia Academy</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/zh-Hans/coin-selection/"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/coin-selection/" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh-Hans/coin-selection/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chialisp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Network<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/Chia-Network/chia-blockchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh-Hans/docs-home/">Getting Started</a><button aria-label="展开侧边栏分类 &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/zh-Hans/installation/">Advanced User Docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/installation/">Advanced Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/testnets/">Testnets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/timelord-install/">Timelords</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/zh-Hans/plotting-basics/">Plotting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/zh-Hans/farming-basics/">Farming</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/zh-Hans/chia-key-management/">Reference Client</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/chia-key-management/">Key Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/passphrases-protected-keys/">Password Protected Keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh-Hans/headless-node/">Headless Node</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh-Hans/coin-selection/">Coin Selection</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/zh-Hans/rpc/">RPC Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/zh-Hans/cli/">CLI Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/zh-Hans/walletconnect-commands/">WalletConnect</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-Hans/troubleshooting/check-if-things-are-working/">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-Hans/contribution/using-github/">Contributing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh-Hans/coin-set-intro/">Learn More</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced User Docs</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference Client</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Coin Selection</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Coin Selection</h1></header><p>Chia uses the <a href="/zh-Hans/coin-set-intro/">Coin Set</a> model of accounting, under which <em>everything</em> is a coin. When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.) When Chia wallets perform certain actions, they must select one or more coins to spend or reserve. (Coin selection is performed automatically by the software; the wallet&#x27;s user is not involved.)</p>
<p>Actions that require coin selection include, but are not limited to:</p>
<ul>
<li>Sending XCH to another wallet</li>
<li>Locking up XCH in an Offer</li>
<li>Creating a DID</li>
</ul>
<p>Sometimes, coin selection is a straight-forward task. For example, let&#x27;s say Alice&#x27;s wallet contains one coin worth 1 XCH, and she wants to send 0.5 XCH to Bob. Alice&#x27;s wallet will handle this by:</p>
<ol>
<li>Spending the 1-XCH coin, thereby unlocking its value</li>
<li>Creating a coin worth 0.5 XCH and assigning it to Bob&#x27;s wallet</li>
<li>Creating another coin worth 0.5 XCH and assigning it to Alice&#x27;s wallet as &quot;change&quot;</li>
</ol>
<p>In this case, there was only one coin to select, so the choice was obvious. Let&#x27;s look at a more complex example. Let&#x27;s look at a more complex example.</p>
<p>Alice wants to send 0.5 XCH to Bob. In her wallet, she has:</p>
<ul>
<li>One coin worth 0.6 XCH</li>
<li>One coin worth 0.3 XCH</li>
<li>One coin worth 0.2 XCH</li>
</ul>
<p>Her wallet has two obvious choices in deciding which coin(s) to spend:</p>
<ol>
<li>Spend the 0.6-XCH coin and create two new coins: one worth 0.5 XCH for Bob, and one worth 0.1 XCH for Alice&#x27;s change.</li>
<li>Spend the coins worth 0.3 XCH and 0.2 XCH and create one new coin worth 0.5 XCH for Bob. No change coin is needed in this case. No change coin is needed in this case.</li>
</ol>
<p>For option 1, Alice&#x27;s wallet spends one coin and creates two coins -- 1 input, 2 outputs.</p>
<p>For option 2, Alice&#x27;s wallet spends two coins and creates one coin -- 2 inputs, 1 output.</p>
<p>Which option will Alice&#x27;s wallet choose?</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="old-algorithm----largest-first">Old algorithm -- largest first<a class="hash-link" aria-label="Old algorithm -- largest first的直接链接" title="Old algorithm -- largest first的直接链接" href="/zh-Hans/coin-selection/#old-algorithm----largest-first">​</a></h4>
<p>Prior to version 1.4 of Chia&#x27;s reference wallet, option 1 would have been chosen. This is because the reference wallet simply selected the largest coin available. If that coin didn&#x27;t contain a sufficient amount of XCH to complete the transaction, the wallet added the next-largest coin, and so on until a sufficient amount was reached. This is because the reference wallet simply selected the largest coin available. If that coin didn&#x27;t contain a sufficient amount of XCH to complete the transaction, the wallet added the next-largest coin, and so on until a sufficient amount was reached.</p>
<p>This algorithm was simple, but it created some frustrating outcomes. For example, let&#x27;s say Alice wanted to create an offer to buy an NFT for 0.0001 XCH. In her wallet, she had:</p>
<ul>
<li>One coin worth 0.0001 XCH</li>
<li>One coin worth 10 XCH</li>
</ul>
<p>In this case, her wallet would have selected the 10-XCH coin. While waiting for her offer to be accepted, her 10-XCH coin would have been reserved, and only her 0.0001-XCH coin would have been available to be spent. In this case, her wallet would have selected the 10-XCH coin. While waiting for her offer to be accepted, her 10-XCH coin would have been reserved, and only her 0.0001-XCH coin would have been available to be spent. This would have been all the more frustrating for Alice because she had a coin worth exactly the correct amount (0.0001 XCH), but it wasn&#x27;t selected.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="new-algorithm----knapsack">New algorithm -- knapsack<a class="hash-link" aria-label="New algorithm -- knapsack的直接链接" title="New algorithm -- knapsack的直接链接" href="/zh-Hans/coin-selection/#new-algorithm----knapsack">​</a></h4>
<p>Starting in version 1.4, Chia&#x27;s reference wallet switched to using the same coin-selection algorithm as Bitcoin Core. This algorithm&#x27;s basic outline goes like this: This algorithm&#x27;s basic outline goes like this:</p>
<ol>
<li>Search for a single coin that matches the amount to be sent, including the transaction fee. If an exact match is found, use it. If an exact match is found, use it.</li>
<li>Add up all of the coins smaller than the amount to be sent. If they match exactly, use them. If they match exactly, use them.</li>
<li>If the sum of the smaller coins is smaller than the amount to be sent, then an exact match is impossible. In this case, use the smallest coin that is larger than the amount to be sent. In this case, use the smallest coin that is larger than the amount to be sent.</li>
<li>Run the knapsack selection algorithm:<!-- -->
<ul>
<li>Sort all coins that are smaller than the amount to be sent, in descending order.</li>
<li>Traverse the list of sorted coins, and choose whether to select each individual coin, where each coin has a 50% probability of being selected.</li>
<li>As each new coin is selected, determine whether the sum of the selected coins is greater than or equal to the amount to be sent. If yes, then a valid solution has been found. If, and only if, this is the best valid solution so far (defined as the solution that comes closest to the amount to be sent), save it. If yes, then a valid solution has been found. If, and only if, this is the best valid solution so far (defined as the solution that comes closest to the amount to be sent), save it.</li>
<li>Replace the last coin selected with a smaller coin. If, an only if, this results in the best solution so far, save it. If, an only if, this results in the best solution so far, save it.</li>
<li>Continue to traverse the list, using various combinations of selected coins in search of a better solution than the best one found so far. Do this for up to 1000 iterations. Do this for up to 1000 iterations.</li>
<li>If no valid solution has been found after 1000 iterations, re-traverse the list of smaller coins, this time selecting all of them. Once again, save only the best solution. Once again, save only the best solution.</li>
<li>Perform up to 1000 iterations of this second traversal. Perform up to 1000 iterations of this second traversal. If we exclude edge cases, such as when a wallet contains more than 1000 coins, a valid solution will be found -- the sum of the smaller coins is larger than the amount to be sent.</li>
</ul>
</li>
</ol>
<p>Let&#x27;s review the scenario from the previous section and apply the new coin selection algorithm.</p>
<p>Alice wants to send 0.5 XCH to Bob. In her wallet, she has:</p>
<ul>
<li>One coin worth 0.6 XCH</li>
<li>One coin worth 0.3 XCH</li>
<li>One coin worth 0.2 XCH</li>
</ul>
<p>Under the new algorithm, Alice&#x27;s wallet will:</p>
<ol>
<li>Search for a single coin that matches. None are found. None are found.</li>
<li>Add up all of the smaller coins. Add up all of the smaller coins. An exact match is found (0.3 + 0.2 = 0.5), so use it.</li>
</ol>
<p>Now let&#x27;s say Alice wanted to include a transaction fee of 10 million mojos (0.00001 XCH). In this case, step 2 would fail to produce an exact match, so we would move to the next step: In this case, step 2 would fail to produce an exact match, so we would move to the next step:</p>
<ol start="3">
<li>The sum of all smaller coins is still smaller than the amount to be sent, so the coin worth 0.6 XCH would be used.</li>
</ol>
<p>Let&#x27;s look at a more complex example:</p>
<p>Alice wants to send 0.5 XCH to Bob. Alice wants to send 0.5 XCH to Bob. She will include a transaction fee of 0.00001 XCH. In her wallet, she has: In her wallet, she has:</p>
<ul>
<li>One coin worth 0.6 XCH</li>
<li>One coin worth 0.5 XCH</li>
<li>One coin worth 0.4 XCH</li>
<li>One coin worth 0.3 XCH</li>
<li>One coin worth 0.2 XCH</li>
</ul>
<p>Prior to version 1.4, the 0.6-XCH coin would have been selected. In versions 1.4 and later, the new algorithm is applied: In versions 1.4 and later, the new algorithm is applied:</p>
<ol>
<li>No single coin matches the amount plus the fee (0.50001).</li>
<li>The sum of the smaller coins is 0.5 + 0.4 + 0.3 + 0.2 = 1.4, which does not equal 0.50001.</li>
<li>The sum from step 2 is larger than the amount to be sent.</li>
<li>Let&#x27;s say the following coin selections occur:<!-- -->
<ul>
<li>0.5 - not selected</li>
<li>0.4 - selected</li>
<li>0.3 - selected</li>
</ul>
</li>
</ol>
<p>At this point, we have a valid match: 0.4 + 0.3 &gt; 0.50001. At this point, we have a valid match: 0.4 + 0.3 &gt; 0.50001. The final coin in Alice&#x27;s wallet is worth 0.2 XCH. If this coin is selected, it will replace the coin worth 0.3 XCH, making the best match 0.4 + 0.2. If this coin is not selected, a better match will not be found. If this coin is selected, it will replace the coin worth 0.3 XCH, making the best match 0.4 + 0.2. If this coin is not selected, a better match will not be found.</p>
<p>This example shows two interesting facets of the new algorithm:</p>
<ol>
<li>It is not always possible to predict which coins will be selected.</li>
<li>The best possible match is not guaranteed to be found.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="why-use-knapsack">Why use knapsack?<a class="hash-link" aria-label="Why use knapsack?的直接链接" title="Why use knapsack?的直接链接" href="/zh-Hans/coin-selection/#why-use-knapsack">​</a></h4>
<p>This algorithm is used in both Bitcoin Core and Chia&#x27;s reference wallet because it provides a good balance between accuracy and computational intensity. It is also clearly superior in many cases. It is also clearly superior in many cases.</p>
<p>Let&#x27;s revisit the example from the top of this document:</p>
<p>Alice wants to create an offer to buy an NFT for 0.0001 XCH. In her wallet, she has: In her wallet, she has:</p>
<ul>
<li>One coin worth 0.0001 XCH</li>
<li>One coin worth 10 XCH</li>
</ul>
<p>Under the old algorithm, the 10-XCH coin would have been selected and reserved for the offer. Under the old algorithm, the 10-XCH coin would have been selected and reserved for the offer. This would have left Alice with a spendable balance of 0.0001 XCH while the offer was pending.</p>
<p>Under the new algorithm, the 0.0001-XCH coin is selected and reserved. Alice still has 10 XCH available to spend. Alice still has 10 XCH available to spend.</p>
<p>Because of scenarios such as this, wallet developers in Chia&#x27;s community are recommended to use the knapsack algorithm for coin selection.</p>
<p>For more information, see:</p>
<ul>
<li>A <a href="https://blog.summerofbitcoin.org/coin-selection-for-dummies-part-3/" target="_blank" rel="noopener noreferrer">blog</a> explaining the knapsack algorithm</li>
<li>The <a href="https://murch.one/wp-content/uploads/2016/11/erhardt2016coinselection.pdf" target="_blank" rel="noopener noreferrer">technical details</a> of the knapsack algorithm used by Bitcoin Core, including edge cases not mentioned here</li>
<li>The <a href="https://github.com/Chia-Network/chia-blockchain/blob/main/chia/wallet/coin_selection.py" target="_blank" rel="noopener noreferrer">source code</a> Chia uses for coin selection</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/reference-client/coin-selection.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh-Hans/headless-node/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Headless Node</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh-Hans/rpc/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://docs.chia.net/consensus-intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li><li class="footer__item"><a href="https://docs.chia.net/academy-home/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chia Academy</a></li><li class="footer__item"><a href="https://docs.chia.net/guides/crash-course/introduction" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Guides</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://chia.net/terms">Terms</a></div></div></div></footer></div>
</body>
</html>
"use strict";(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[6541],{3123:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>o,toc:()=>h});const o=JSON.parse('{"id":"reference-client/troubleshooting/node-syncing","title":"Node Syncing","description":"Forwarding port 8444 can solve some sync issues and it also helps improve Chia\'s overall network health.","source":"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/reference-client/troubleshooting/node-syncing.md","sourceDirName":"reference-client/troubleshooting","slug":"/reference-client/troubleshooting/node-syncing","permalink":"/zh-Hans/reference-client/troubleshooting/node-syncing","draft":false,"unlisted":false,"editUrl":"https://github.com/Chia-Network/chia-docs/blob/main/docs/reference-client/troubleshooting/node-syncing.md","tags":[],"version":"current","frontMatter":{"title":"Node Syncing","slug":"/reference-client/troubleshooting/node-syncing"},"sidebar":"tutorialSidebar","previous":{"title":"\u751f\u6210\u5730\u5757\u5e38\u89c1\u95ee\u9898\u89e3\u7b54","permalink":"/zh-Hans/reference-client/troubleshooting/plotting-faq"},"next":{"title":"Logging Reference","permalink":"/zh-Hans/reference-client/troubleshooting/logging-reference"}}');var r=t(4848),a=t(8453),i=t(1470),s=t(9365);const l={title:"Node Syncing",slug:"/reference-client/troubleshooting/node-syncing"},c=void 0,d={},h=[{value:"Port Forwarding Settings",id:"port-forwarding-settings",level:2},{value:"Why forward port 8444?",id:"why-forward-port-8444",level:2},{value:"Speed up connecting to nodes",id:"speed-up-connecting-to-nodes",level:2},{value:"Detailed explanation",id:"detailed-explanation",level:2},{value:"Dealing With Carrier-Grade NAT",id:"dealing-with-carrier-grade-nat",level:2},{value:"Community Nodes",id:"community-nodes",level:2},{value:"Database Schema Compatibility Issues",id:"database-schema-compatibility-issues",level:2},{value:"Chia 2.5.5+ Schema Changes",id:"chia-255-schema-changes",level:3},{value:"Symptoms",id:"symptoms",level:4},{value:"Downgrade Database Fix",id:"downgrade-database-fix",level:4},{value:"Prevention",id:"prevention",level:4}];function u(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Forwarding port 8444 can solve some sync issues and it also helps improve Chia's overall network health."}),"\n",(0,r.jsxs)(n.p,{children:["Port 8444 is the ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Port_%28computer_networking%29",children:"port"})," through which other Chia computers can communicate with your PC. When you set up port forwarding on port 8444, the Chia software on your computer allows other nodes to easily communicate and sync the Chia blockchain with your node."]}),"\n",(0,r.jsx)(n.p,{children:"When the network undergoes rapid growth and expansion the newly arriving Chia nodes may not initially open port 8444, resulting in difficulty finding available nodes to sync with. Therefore, it is strongly recommended that you enable port forwarding."}),"\n",(0,r.jsxs)(n.p,{children:["With the Chia software running, use ",(0,r.jsx)(n.a,{href:"https://portchecker.co/",children:"this port checker"})," to check if your IP address is accepting outside connections on port 8444. Further port forwarding configurations may still be necessary on your router (or VPN software)."]}),"\n",(0,r.jsx)(n.h2,{id:"port-forwarding-settings",children:"Port Forwarding Settings"}),"\n",(0,r.jsxs)(n.p,{children:["Port forwarding is done on your router (or VPN software). How you set it up depends on your router's make and model. Look through your router's manual or just search for \"",(0,r.jsx)(n.code,{children:"<your router name and model>"}),' how to port forward" to get started.']}),"\n",(0,r.jsx)(n.p,{children:"When you port forward you want to allow outside IP addresses to connect to your main node (computer) through port 8444 to the Chia software."}),"\n",(0,r.jsxs)(n.p,{children:["If your router has UPNP enabled the Chia software by default ",(0,r.jsx)(n.code,{children:"enable_upnp: true"})," will attempt to automatically configure port forwarding, if your router disabled UPNP then you will need to manually configure port forwarding."]}),"\n",(0,r.jsx)(n.p,{children:"Most routers will ask you from where you are allowing and to what you are connecting to. You want to set up port forwarding to allow any outside connection to connect to the IP address of your main node on your network through port 8444. Router manufacturers might call the settings different things, but the concept is always the same: Outside computers connecting through port 8444 to your computer."}),"\n",(0,r.jsx)(n.p,{children:"Here are the settings most routers will ask for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set connection type to ",(0,r.jsx)(n.em,{children:"TCP"})," or ",(0,r.jsx)(n.em,{children:"TCP & UDP"})]}),"\n",(0,r.jsx)(n.li,{children:'Destination (or forwarding) IP address - This is your main node (computer) IP address on your internal network; search online on how to do this for your type of computer. If you search for "what is my IP address" it will give you your external IP address, this is not the one you want.'}),"\n",(0,r.jsxs)(n.li,{children:["Originating (or from) IP address - Set this to all or sometimes just an asterisk may be used ",(0,r.jsx)(n.code,{children:"*"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Running multiple full nodes on the same local network often requires unique IP and Port settings in both the router and Chia software to avoid conflicts, you may also need to disable UPNP ",(0,r.jsx)(n.code,{children:"enable_upnp: false"})," in the Chia ",(0,r.jsx)(n.code,{children:"config.yaml"})," file or your router if it is enabled."]}),"\n",(0,r.jsx)(n.h2,{id:"why-forward-port-8444",children:"Why forward port 8444?"}),"\n",(0,r.jsx)(n.p,{children:"All newly added nodes are completely dependent on nodes that are allowing port forwarding, because they are the only nodes in which they can sync with. The more nodes there are that don't allow port forwarding can cause a bottleneck to those nodes that do have it enabled."}),"\n",(0,r.jsx)(n.p,{children:"If you enable port forwarding, your node will sync faster, and you will be helping to ensure the stability and overall health of the Chia network."}),"\n",(0,r.jsx)(n.h2,{id:"speed-up-connecting-to-nodes",children:"Speed up connecting to nodes"}),"\n",(0,r.jsx)(n.p,{children:"If you would like to speed up connectivity to other nodes and increase your sync speed, add the introducer node to your Chia client:"}),"\n",(0,r.jsxs)(i.A,{defaultValue:"mainnet",groupId:"introducers",values:[{label:"Mainnet",value:"mainnet"},{label:"Testnet11",value:"testnet11"}],children:[(0,r.jsx)(s.A,{value:"mainnet",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- Mainnet Introducer: `introducer.chia.net:8444`\n\nNote: please only use the CNI operated nodes as a last resort for connecting to peers, these nodes might be running different client versions and are not intended to be used as trusted full nodes.\n- CNI Operated Full Node: `node.chia.net`\n\nAdditionally, you can also visit either of the below websites that are frequently updated with available nodes listening on port 8444:\n- [ChiaNodes.com](https://ChiaNodes.com)\n- [chia.keva.app](https://chia.keva.app)\n"})})}),(0,r.jsx)(s.A,{value:"testnet11",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"- DNS Introducer: `dns-introducer-testnet11.chia.net`\n- Legacy Introducer: `introducer-testnet11.chia.net:58444`\n\nNote: please only use the CNI operated nodes as a last resort for connecting to peers, these nodes might be running different client versions and are not intended to be used as trusted full nodes.\n- CNI Operated Full Node: `testnet11-node.chia.net`\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:['Nodes (IPs) from these sites can be added in the GUI from the Full Node tab, select the Full Node button in the top right corner and then choose "Connect to Other Peers". You can also add nodes via the CLI with the command ',(0,r.jsx)(n.code,{children:"chia peer full_node -a PEER_ADDRESS:PORT"})," where ",(0,r.jsx)(n.code,{children:"PORT"})," will typically be 8444."]}),"\n",(0,r.jsx)(n.h2,{id:"detailed-explanation",children:"Detailed explanation"}),"\n",(0,r.jsx)(n.p,{children:'A regular pc can communicate out with endless ports-- if the user is sending a signal out -- pc opens a port -- signal goes out, pc closes the port. Chia uses port 8444 as instant verified communication. So an open port can allow instant communication and start the blockchain sync. Signal comes in on port 8444- that Chia pc is verified, then both user\'s pc, opens their own "communication ports ex port 8421" and that new user can now sync and now they are linked together forming part of Chia mesh.'}),"\n",(0,r.jsx)(n.p,{children:"If the users port 8444 is closed, the users pc has to start sending multiple signals out and hope that a pc with open port 8444 will link with them, then the sync starts. (1) pc can only link up a few pc and with so many other Chia users coming on board, they all have to wait. Keep in mind, Chia is built on a mesh network, the blockchain is shared among all the users, not from central pc."}),"\n",(0,r.jsx)(n.h2,{id:"dealing-with-carrier-grade-nat",children:"Dealing With Carrier-Grade NAT"}),"\n",(0,r.jsxs)(n.p,{children:["Have you opened port 8444 on your router but still not getting connections? With the exhaustion of the IPv4 network space, it's increasingly common for ISPs to use ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Carrier-grade_NAT",children:"Carrier-Grade NAT"})," (CGN, CG-NAT, NAT444) by placing multiple customers behind a single IP address. In this case, even if you open 8444 on your router, other nodes will not be able to connect to you. There are a couple options:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Ask your ISP for a dedicated IP address. They\'ll probably want more money and may require you to upgrade to a "business" plan.'}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Establish a VPN tunnel through the NAT to a cloud server with a public IP address. It's easier than it sounds and can cost as little as $3-5 a month for a cheap cloud server (some common cloud server providers: AWS, GCP, Digital Ocean, Vultr, Hetzner, Linode). When selecting a provider and server size, pay careful attention to bandwidth; a Chia fullnode isn't too demanding, but can require several GB per day. 1 TB per month is typical of lower-cost VPSs and should be plenty (do keep an eye on it though, bandwidth overage costs can be expensive!)."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Setting up a VPN used to be a daunting task, but ",(0,r.jsx)(n.a,{href:"https://www.wireguard.com",children:"Wireguard"})," has greatly simplified it. The summary is you run Wireguard on both your home server and the cloud server:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"the cloud server is configured to listen for VPN connections from your home server and route all traffic incoming on 8444 to your home server, while also routing outgoing traffic from your home server to the internet."}),"\n",(0,r.jsx)(n.li,{children:'the home server is configured to route all internet traffic (but not local) through the cloud server, while periodically sending a "keepalive" packet to ensure the connection stays open.'}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Here is a more detailed write-up with ",(0,r.jsx)(n.a,{href:"https://www.kmr.me/posts/wireguard/",children:"example wireguard configuration"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"community-nodes",children:"Community Nodes"}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["We ",(0,r.jsx)(n.strong,{children:"never"})," recommend connecting to a community node. This section will detail why."]})}),"\n",(0,r.jsx)(n.p,{children:'A "community node" (AKA an untrusted node) is a node that other farmers can connect to, in order to avoid having to run their own full node.'}),"\n",(0,r.jsx)(n.p,{children:"While this may seem like a convenient setup, community nodes are inherently not secure, and we therefore never recommend connecting to them. The primary issue is that the community node can steal farmer rewards. The reason for this is because the farmer service was created with the security assumption that it would only connect to a local/trusted node."}),"\n",(0,r.jsx)(n.p,{children:"This means that:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The farmer never verifies anything that the node puts into a block","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The farmer blind-signs whatever the node sends it"}),"\n",(0,r.jsx)(n.li,{children:"The farmer doesn't verify the reward address"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"The community node can therefore modify the reward address before the farmer signs a block"}),"\n",(0,r.jsx)(n.li,{children:"Any modifications we could make to the farmer would have widespread ripple effects to the rest of the node software, so we won't support any such modifications"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In summary, if you farm using a community node, that node can steal all of your farming rewards as you earn them. The way to avoid this scenario is to run your own node."}),"\n",(0,r.jsxs)(n.p,{children:["Luckily, a high-powered system is not required to run a Chia node. In fact, the ",(0,r.jsx)(n.a,{href:"https://docs.chia.net/chia-blockchain/coin-set-model/costs/#farming-spec",children:"minimum supported node hardware"})," is the Raspberry Pi with a cheap external SSD to hold the database file. In order to expedite the process of syncing your full node, you can download a ",(0,r.jsx)(n.a,{href:"https://www.chia.net/downloads/#database-checkpoint",children:"database checkpoint"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"database-schema-compatibility-issues",children:"Database Schema Compatibility Issues"}),"\n",(0,r.jsx)(n.h3,{id:"chia-255-schema-changes",children:"Chia 2.5.5+ Schema Changes"}),"\n",(0,r.jsx)(n.p,{children:"Starting in Chia 2.5.5, the mempool has undergone backwards incompatible schema changes to support new fast-forward functionality and optimizations. These changes can cause database compatibility issues when connecting nodes running different versions."}),"\n",(0,r.jsx)(n.h4,{id:"symptoms",children:"Symptoms"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"Database schema version mismatch"})})," errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"Invalid spent_index value"})})," errors"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connection refused"})," when trying to connect to nodes running different versions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node fails to start"})," after upgrading from earlier versions"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"downgrade-database-fix",children:"Downgrade Database Fix"}),"\n",(0,r.jsx)(n.p,{children:"If you need to downgrade from Chia 2.5.5+ back to an earlier version, you must first fix the database schema incompatibility. Run this command to reset the spent index values:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"python -c \"import sqlite3, sys, os; conn = sqlite3.connect(os.path.expanduser(sys.argv[1])); cursor = conn.execute('UPDATE coin_record SET spent_index = 0 WHERE spent_index = -1'); print(f'Updated {cursor.rowcount} records'); conn.commit(); conn.close()\" <path to the db>\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Replace ",(0,r.jsx)(n.code,{children:"<path to the db>"})]})," with the actual path to your Chia database file (typically ",(0,r.jsx)(n.code,{children:"~/.chia/mainnet/db/blockchain_v2_mainnet.sqlite"}),")."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Warning"}),": This command modifies your blockchain database. Only use it if you are certain you need to downgrade, and always backup your database first."]}),"\n",(0,r.jsx)(n.h4,{id:"prevention",children:"Prevention"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Always upgrade all nodes simultaneously when possible"}),"\n",(0,r.jsx)(n.li,{children:"Test upgrades on testnet before applying to mainnet"}),"\n",(0,r.jsx)(n.li,{children:"Keep backups of your database before major version changes"}),"\n",(0,r.jsx)(n.li,{children:"Ensure all connected nodes are running compatible versions"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},9365:(e,n,t)=>{t.d(n,{A:()=>i});t(6540);var o=t(4164);const r={tabItem:"tabItem_Ymn6"};var a=t(4848);function i({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,o.A)(r.tabItem,t),hidden:n,children:e})}},1470:(e,n,t)=>{t.d(n,{A:()=>j});var o=t(6540),r=t(4164),a=t(3104),i=t(6347),s=t(205),l=t(7485),c=t(1682),d=t(679);function h(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return h(e).map((({props:{value:e,label:n,attributes:t,default:o}})=>({value:e,label:n,attributes:t,default:o})))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p({value:e,tabValues:n}){return n.some((n=>n.value===e))}function m({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})}),[r,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=u(e),[i,l]=(0,o.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a}))),[c,h]=m({queryString:t,groupId:r}),[f,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,d.Dv)(n);return[t,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:r}),y=(()=>{const e=c??f;return p({value:e,tabValues:a})?e:null})();(0,s.A)((()=>{y&&l(y)}),[y]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),g(e)}),[h,g,a]),tabValues:a}}var g=t(2303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var w=t(4848);function b({className:e,block:n,selectedValue:t,selectValue:o,tabValues:i}){const s=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),c=e=>{const n=e.currentTarget,r=s.indexOf(n),a=i[r].value;a!==t&&(l(n),o(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=s.indexOf(e.currentTarget)+1;n=s[t]??s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;n=s[t]??s[s.length-1];break}}n?.focus()};return(0,w.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:i.map((({value:e,label:n,attributes:o})=>(0,w.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{s.push(e)},onKeyDown:d,onClick:c,...o,className:(0,r.A)("tabs__item",y.tabItem,o?.className,{"tabs__item--active":t===e}),children:n??e},e)))})}function x({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find((e=>e.props.value===t));return e?(0,o.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,w.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function v(e){const n=f(e);return(0,w.jsxs)("div",{className:(0,r.A)("tabs-container",y.tabList),children:[(0,w.jsx)(b,{...n,...e}),(0,w.jsx)(x,{...n,...e})]})}function j(e){const n=(0,g.A)();return(0,w.jsx)(v,{...e,children:h(e.children)},String(n))}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var o=t(6540);const r={},a=o.createContext(r);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[4092],{5220:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>t,contentTitle:()=>c,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>r});var n=a(5893),o=a(1151);const i={slug:"/guides/custom-puzzle-lock-tutorial",title:"Custom Puzzle Lock"},c=void 0,l={id:"guides/tutorials/custom-puzzle-lock",title:"Custom Puzzle Lock",description:"This tutorial teaches you how to lock a coin with a custom-made puzzle.",source:"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/guides/tutorials/custom-puzzle-lock.md",sourceDirName:"guides/tutorials",slug:"/guides/custom-puzzle-lock-tutorial",permalink:"/zh-Hans/guides/custom-puzzle-lock-tutorial",draft:!1,unlisted:!1,editUrl:"https://github.com/Chia-Network/chia-docs/blob/main/docs/guides/tutorials/custom-puzzle-lock.md",tags:[],version:"current",frontMatter:{slug:"/guides/custom-puzzle-lock-tutorial",title:"Custom Puzzle Lock"},sidebar:"guides",previous:{title:"Application Structure",permalink:"/zh-Hans/guides/application-structure-tutorial"},next:{title:"Custody Tool",permalink:"/zh-Hans/guides/custody-tool"}},t={},r=[{value:"Create a puzzle",id:"create-a-puzzle",level:2},{value:"Get compiled version of the custom puzzle",id:"get-compiled-version-of-the-custom-puzzle",level:2},{value:"Using clvm_tools (official)",id:"using-clvm_tools-official",level:3},{value:"Using Chialisp web tool (unofficial)",id:"using-chialisp-web-tool-unofficial",level:3},{value:"Get puzzle hash from a puzzle",id:"get-puzzle-hash-from-a-puzzle",level:2},{value:"Using clvm_tools",id:"using-clvm_tools",level:3},{value:"Using Chialisp",id:"using-chialisp",level:3},{value:"Convert puzzle hash to a receive address",id:"convert-puzzle-hash-to-a-receive-address",level:2},{value:"Send Chia to the receive address",id:"send-chia-to-the-receive-address",level:2}];function h(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.p,{children:"This tutorial teaches you how to lock a coin with a custom-made puzzle."}),"\n",(0,n.jsx)(s.h2,{id:"create-a-puzzle",children:"Create a puzzle"}),"\n",(0,n.jsx)(s.p,{children:"Create whatever puzzle you want for your coin. We'll use a password-locked coin as an example for this tutorial."}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-chialisp",children:"(mod (password new_puzhash amount)\n    (defconstant CREATE_COIN 51)\n\n    (if (= (sha256 password) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824))\n        (list (list CREATE_COIN new_puzhash amount))\n        (x)\n    )\n)\n"})}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.code,{children:"0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824"})," is the sha256 hash of the word ",(0,n.jsx)(s.code,{children:"hello"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Example valid solution:"})," ",(0,n.jsx)(s.code,{children:"(hello 0x5f5767744f91c1c326d927a63d9b34fa7035c10e3eb838c44e3afe127c1b7675 2)"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["If password is correct, the puzzle will create a new coin with 2 mojos and lock it using a new puzzle hash ",(0,n.jsx)(s.code,{children:"0x5f5767744f91c1c326d927a63d9b34fa7035c10e3eb838c44e3afe127c1b7675"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.strong,{children:"Any remaining change goes to a farmer as a fee"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"get-compiled-version-of-the-custom-puzzle",children:"Get compiled version of the custom puzzle"}),"\n",(0,n.jsx)(s.p,{children:"There are multiple ways how you can get compiled version of your custom puzzle."}),"\n",(0,n.jsxs)(s.h3,{id:"using-clvm_tools-official",children:["Using ",(0,n.jsx)(s.a,{href:"https://github.com/Chia-Network/clvm_tools",children:"clvm_tools"})," (official)"]}),"\n",(0,n.jsxs)(s.p,{children:["You can compile your custom puzzle from the terminal using the clvm_tools repository (included in the official Chia repository). All you need to do is to use the ",(0,n.jsx)(s.code,{children:"run"})," command with your puzzle provided as an argument."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"run '(mod (password new_puzhash amount)\n    (defconstant CREATE_COIN 51)\n\n    (if (= (sha256 password) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824))\n        (list (list CREATE_COIN new_puzhash amount))\n        (x)\n    )\n)'\n"})}),"\n",(0,n.jsxs)(s.p,{children:["results in ",(0,n.jsx)(s.code,{children:"(a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1))"}),"."]}),"\n",(0,n.jsxs)(s.h3,{id:"using-chialisp-web-tool-unofficial",children:["Using ",(0,n.jsx)(s.a,{href:"https://clisp.surrealdev.com/",children:"Chialisp web tool"})," (unofficial)"]}),"\n",(0,n.jsxs)(s.p,{children:["Paste your custom puzzle into the text area and hit ",(0,n.jsx)(s.strong,{children:"Compile"}),". The compiled version will appear in the ",(0,n.jsx)(s.strong,{children:"Run Output"})," section."]}),"\n",(0,n.jsx)(s.h2,{id:"get-puzzle-hash-from-a-puzzle",children:"Get puzzle hash from a puzzle"}),"\n",(0,n.jsxs)(s.h3,{id:"using-clvm_tools",children:["Using ",(0,n.jsx)(s.a,{href:"https://github.com/Chia-Network/clvm_tools",children:"clvm_tools"})]}),"\n",(0,n.jsxs)(s.p,{children:["You can get the hash of your Chialisp puzzle with the ",(0,n.jsx)(s.code,{children:"opc -H <compiled_puzzle>"})," command included in the official clvm_tools repository."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"opc -H '(a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1))'\n"})}),"\n",(0,n.jsxs)(s.p,{children:["The response of this command will be a puzzle hash ",(0,n.jsx)(s.strong,{children:"on the first line"})," and a serialized version of your puzzle on the second line."]}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Example response:"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71\nff02ffff01ff02ffff03ffff09ffff0bff0580ffff01a02cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b982480ffff01ff04ffff04ff02ffff04ff0bffff04ff17ff80808080ff8080ffff01ff088080ff0180ffff04ffff0133ff018080\n"})}),"\n",(0,n.jsxs)(s.p,{children:["As you can see from the first line of this response, puzzle hash for our custom puzzle is ",(0,n.jsx)(s.code,{children:"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71"})]}),"\n",(0,n.jsx)(s.h3,{id:"using-chialisp",children:"Using Chialisp"}),"\n",(0,n.jsx)(s.p,{children:"You can also use Chialisp itself to get the hash of the Chialisp puzzle. The puzzle to get a puzzle hash is following:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-chialisp",children:"(mod (puzzle)\n    (defconstant TREE 1)\n\n    (defun sha256tree1 (TREE)\n       (if (l TREE)\n           (sha256 2 (sha256tree1 (f TREE)) (sha256tree1 (r TREE)))\n           (sha256 1 TREE)\n       )\n    )\n\n    (sha256tree1 puzzle)\n)\n"})}),"\n",(0,n.jsx)(s.p,{children:"A solution to this puzzle then needs to contain the compiled puzzle we want to hash in the first position (wrap the compiled puzzle with parentheses and provide it as a solution)."}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.strong,{children:"Example solution for the password-locked coin:"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-chialisp",children:"((a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1))) 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1)))\n"})}),"\n",(0,n.jsxs)(s.p,{children:["The resulting hash for this example puzzle is again ",(0,n.jsx)(s.code,{children:"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"convert-puzzle-hash-to-a-receive-address",children:"Convert puzzle hash to a receive address"}),"\n",(0,n.jsx)(s.p,{children:"You can convert a puzzle hash to a receive address and vice-versa. An address is just an encoded puzzle hash. And since a puzzle hash matches specific puzzle, it also means that a receive address matches a specific puzzle."}),"\n",(0,n.jsxs)(s.p,{children:["You can use an online tool from ",(0,n.jsx)(s.a,{href:"https://www.spacescan.io/tools/puzzlehashconverter",children:"spacescan.io"})," for converting between puzzle hash to receive address. The puzzle hash is encoded to bech32m format with xch prefix to form a receive address. The receive address for the puzzle hash ",(0,n.jsx)(s.code,{children:"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71"})," is ",(0,n.jsx)(s.code,{children:"xch1fppus6dm5hm94g0gqmxnwtdw2e5v5wmfvsxsvl5xsd72j6ejfecsdnkf2e"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"send-chia-to-the-receive-address",children:"Send Chia to the receive address"}),"\n",(0,n.jsxs)(s.p,{children:["Use the Chia GUI or CLI to send a transaction as you would typically do with the amount you want. As a receive address, set the address from the previous step (password-locked coin example: ",(0,n.jsx)(s.code,{children:"xch1fppus6dm5hm94g0gqmxnwtdw2e5v5wmfvsxsvl5xsd72j6ejfecsdnkf2e"}),"). That will lock your coin with a new puzzle."]}),"\n",(0,n.jsx)(s.hr,{}),"\n",(0,n.jsxs)(s.p,{children:["If you have further questions, join our ",(0,n.jsx)(s.a,{href:"https://discord.gg/chia",children:"Discord"})," and ask in the #chialisp channel."]})]})}function d(e={}){const{wrapper:s}={...(0,o.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},1151:(e,s,a)=>{a.d(s,{Z:()=>l,a:()=>c});var n=a(7294);const o={},i=n.createContext(o);function c(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);
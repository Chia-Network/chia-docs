(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[4385],{785:(e,s,n)=>{"use strict";n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>h});var t=n(5893),i=n(1151),r=n(773);const o={title:"Signatures",slug:"/chialisp-signatures"},l=void 0,a={id:"academy/chialisp/chialisp-signatures",title:"Signatures",description:"In this lesson, we go over how to secure coins using signatures.",source:"@site/docs/academy/chialisp/chialisp-signatures.md",sourceDirName:"academy/chialisp",slug:"/chialisp-signatures",permalink:"/chialisp-signatures",draft:!1,unlisted:!1,editUrl:"https://github.com/Chia-Network/chia-docs/blob/main/docs/academy/chialisp/chialisp-signatures.md",tags:[],version:"current",frontMatter:{title:"Signatures",slug:"/chialisp-signatures"},sidebar:"academy",previous:{title:"Smart Coins",permalink:"/chialisp-smart-coin"},next:{title:"Inner Puzzles",permalink:"/chialisp-inner-puzzle"}},c={},h=[{value:"Learning objectives",id:"learning-objectives",level:2},{value:"Content",id:"content",level:2},{value:"Script",id:"script",level:2},{value:"Common gotchas",id:"common-gotchas",level:2},{value:"Knowledge check",id:"knowledge-check",level:2},{value:"Additional resources",id:"additional-resources",level:2},{value:"Runnable Chialisp and clvm plugins",id:"runnable-chialisp-and-clvm-plugins",level:3},{value:"Chialisp plugin",id:"chialisp-plugin",level:4},{value:"Clvm plugin",id:"clvm-plugin",level:4},{value:"Links",id:"links",level:3}];function d(e){const s={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"In this lesson, we go over how to secure coins using signatures."}),"\n",(0,t.jsx)(s.h2,{id:"learning-objectives",children:"Learning objectives"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Signing and Signatures"}),": Understand the uses and benefits of signatures."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Chialisp Library files"}),": Learn about helpful Chialisp libraries to simplify development."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"content",children:"Content"}),"\n",(0,t.jsx)("div",{class:"videoWrapper",children:(0,t.jsx)("iframe",{width:"100%",height:"504",src:"https://www.youtube.com/embed/zD1rhLKgc9Y",frameborder:"0",allowfullscreen:"allowfullscreen"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"script",children:"Script"}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:" Expand for the full script "}),(0,t.jsxs)(s.p,{children:["00:00",(0,t.jsx)(s.br,{}),"\n","We created our first smart coin and secured it so that only someone with the correct password could spend it. In this video, we'll use a signature to secure our coin so that only the person with the correct signature will be able to spend the coin."]}),(0,t.jsxs)(s.p,{children:["00:20",(0,t.jsx)(s.br,{}),"\n","So what is a signature? A digital signature allows you to sign a message with a private key. This message can then be verified by a recipient using your public key. Let's start with an example of signing a message and then verifying it."]}),(0,t.jsxs)(s.p,{children:["00:40",(0,t.jsx)(s.br,{}),"\n","Run ",(0,t.jsx)(s.code,{children:"chia keys sign --message"})," with the message ",(0,t.jsx)(s.code,{children:'"hello" --hdpath m'})," then choose your wallet ID. This process will sign the message 'hello' with your private key. To verify this message we'll run ",(0,t.jsx)(s.code,{children:"chia keys verify"})," enter the message, then the signature and the sender's public key. (",(0,t.jsx)(s.code,{children:"chia keys verify --message hello --signature [SIG] --public_key [PUB_KEY]"}),")"]}),(0,t.jsxs)(s.p,{children:["01:00",(0,t.jsx)(s.br,{}),"\n","So now that we know how signing works, let's create a coin that can be spent when given the correct signature. So in our chialisp file, let's define a module that takes two parameters. The first will be a public key that we'll curry in later. This will determine who is able to spend the coin."]}),(0,t.jsxs)(s.p,{children:["01:20",(0,t.jsx)(s.br,{}),"\n","The second parameter will be the conditions that determine how the coin will be spent. Next, we'll include some libraries to make our code a bit easier to write. The first lets us use written condition codes rather than number codes, and the second is a library for tree hashing."]}),(0,t.jsxs)(s.p,{children:["01:40",(0,t.jsx)(s.br,{}),"\n","To install these libraries, run this command in the terminal. ",(0,t.jsx)(s.code,{children:"cdv clsp retrieve sha256tree condition-codes"}),". Back to our chialisp file, we'll define a combine statement with",(0,t.jsx)(s.code,{children:"c"})," and for the first parameter, create a list composed of the ",(0,t.jsx)(s.code,{children:"AGG_SIG_ME"})," condition, our public key parameter and the conditions parameter run through the tree hashing library. (",(0,t.jsx)(s.code,{children:"(c (list AGG_SIG_ME PUBLIC_KEY (sha256tree conditions)) conditions)"}),")"]}),(0,t.jsxs)(s.p,{children:["02:00",(0,t.jsx)(s.br,{}),"\n","The second parameter in the combine statement will be the conditions that are passed into the program. So what does this do? Well the ",(0,t.jsx)(s.code,{children:"AGG_SIG_ME"})," condition is a standard condition that signs a message with a public key. In this case we are currying in the key and the message is the tree hash of the conditions parameter."]}),(0,t.jsxs)(s.p,{children:["02:20",(0,t.jsx)(s.br,{}),"\n","We do this so that the conditions cannot be modified by the farmer. So in order to spend the coin, the user must provide a solution that contains a list of conditions; or how they'd like to spend the coin; as well as a signature to show that they are the ones authorized to do so."]}),(0,t.jsxs)(s.p,{children:["02:40",(0,t.jsx)(s.br,{}),"\n","For this example, we're going to create a solution that uses the ",(0,t.jsx)(s.code,{children:"CREATE_COIN"})," condition to essentially unlock the value of the coin and send it back to our wallet. First, let's finish creating this coin. We'll get our master public key with ",(0,t.jsx)(s.code,{children:"chia keys show"})," and curry that into our program. It's important to prefix the key with ",(0,t.jsx)(s.code,{children:"0x"})," to show that it is a value."]}),(0,t.jsxs)(s.p,{children:["03:00",(0,t.jsx)(s.br,{}),"\n","Now we'll get the puzzle reveal with ",(0,t.jsx)(s.code,{children:"opc"})," and enter in the compiled code. Make sure to save this for later. And for the puzzle hash we'll run ",(0,t.jsx)(s.code,{children:"opc -h"})," and enter the compiled code. We'll save this for later as well. We'll need to take the puzzle hash and encode it into an address. Run ",(0,t.jsx)(s.code,{children:"cdv encode --prefix txch"})," and enter the puzzle hash."]}),(0,t.jsxs)(s.p,{children:["03:20",(0,t.jsx)(s.br,{}),"\n","That gives us the puzzle address. Now we'll send an amount of chia to this address to lock it. And we'll check the status. Once confirmed, we'll be ready to spend it."]}),(0,t.jsxs)(s.p,{children:["03:40",(0,t.jsx)(s.br,{}),"\n","To spend the coin, we'll need to create a spend bundle. Take a look at this outline. this should look familiar to the spend bundle we created in the previous video. We'll need four things, the coin record, the puzzle reveal which we already calculated, the solution we want to provide, and an aggregated signature to authorize our spend."]}),(0,t.jsxs)(s.p,{children:["04:00",(0,t.jsx)(s.br,{}),"\n","To get the coin record, run ",(0,t.jsx)(s.code,{children:"cdv rpc coinrecords --by puzzlehash"})," and enter the puzzle hash from earlier. Copy the coin object and paste it into the spend bundle template. Next we can enter the puzzle reveal we calculated earlier. For the solution, we're going to have to so some work."]}),(0,t.jsxs)(s.p,{children:["04:20",(0,t.jsx)(s.br,{}),"\n","We'll use the standard condition ",(0,t.jsx)(s.code,{children:"CREATE_COIN"})," to unlock the value of the coin and send it back to our wallet. To do that, we'll need our address which we can get with ",(0,t.jsx)(s.code,{children:"chia wallet get address"})," and decode it to get the wallet address puzzle hash with ",(0,t.jsx)(s.code,{children:"cdv decode"})," and our address."]}),(0,t.jsxs)(s.p,{children:["04:40",(0,t.jsx)(s.br,{}),"\n","To craft the solution, we'll run this command where ",(0,t.jsx)(s.code,{children:"51"})," is the ",(0,t.jsx)(s.code,{children:"CREATE_COIN"})," condition code, our wallet address puzzle hash, and an amount in mojo. We can enter this response into the solution of our spend bundle."]}),(0,t.jsxs)(s.p,{children:["05:00",(0,t.jsx)(s.br,{}),"\n","Finally, the aggregated signature. Remember that the message we are signing is the tree hash of our conditions; or our solution. So first, let's generate that hash. Next we'll also need the coin ID and the genesis challenge. The genesis challenge is a standard value for each network."]}),(0,t.jsxs)(s.p,{children:["05:20",(0,t.jsx)(s.br,{}),"\n","You can find the appropriate challenge by entering ",(0,t.jsx)(s.code,{children:"chia show -s"})," and searching for 'genesis challenge'. For the coin ID, we actually need the parent ID, the puzzle hash, and the amount which can all be found in the coin record we copied earlier."]}),(0,t.jsxs)(s.p,{children:["05:40",(0,t.jsx)(s.br,{}),"\n","To get the coin ID, we'll run ",(0,t.jsx)(s.code,{children:"cdv inspect -id coins"})," enter the parent ID, the puzzle hash, and the amount. (",(0,t.jsx)(s.code,{children:"cdv inspect -id coins --parent-id [PARENT_ID] --puzzle-hash [PUZZLE_HASH] --amount [AMOUNT]"}),") The ",(0,t.jsx)(s.code,{children:"AGG_SIG_ME"})," condition expects the concatenation of the conditions treehash, coin ID, and genesis challenge, so run"]}),(0,t.jsxs)(s.p,{children:["06:00",(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.code,{children:"concat"})," the conditions treehash, coin ID, and genesis challenge. Make sure to use the prefix ",(0,t.jsx)(s.code,{children:"0x"})," to signify that these are values. Now let's sign this message and since we're NOT using it as a value, remember to remove the ",(0,t.jsx)(s.code,{children:"0x"})," prefix this time."]}),(0,t.jsxs)(s.p,{children:["06:20",(0,t.jsx)(s.br,{}),"\n","Now we can enter this signature into our spend bundle and push it. Run ",(0,t.jsx)(s.code,{children:"cdv rpc pushtx spendbundle.json"}),". If your signature is incorrect, you'll get a failure message. Otherwise, congratulations! You've created a smart coin secured with a signature and spent it."]}),(0,t.jsxs)(s.p,{children:["06:40",(0,t.jsx)(s.br,{}),"\n","So we've talked in this video about how signatures work, their importance, and how to implement them into a smart coin. Thanks so much for watching, I'll see you next time."]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"common-gotchas",children:"Common gotchas"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"0x Prefixes:"})," It's important to keep track of how we are using different values and understand how Chialisp is going to handle them. A common gotcha is forgetting to append ",(0,t.jsx)(s.code,{children:"0x"})," to a value, or in some cases removing it to tell the puzzle how to properly handle the parameter."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:'"Saving for Later":'})," At several points in this lesson, we generate results that we'll need to use elsewhere, sometimes many times. These results also do not have obivious indicators as to what they are. It's helpful to have a document to temporarily store these results for later use."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"knowledge-check",children:"Knowledge check"}),"\n",(0,t.jsx)(s.admonition,{title:"Question 1 - Keys",type:"tip",children:(0,t.jsx)(s.p,{children:"True or False. You need to use someone's private key to lock up a coin for them to spend."})}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:" Answer (expand when ready to see the answer)  "}),(0,t.jsx)(s.p,{children:"False. You would use their public key. Private keys are to be kept secret and never revealed to anyone."})]}),"\n",(0,t.jsx)(s.admonition,{title:"Question 2 - Aggregate Signature",type:"tip",children:(0,t.jsx)(s.p,{children:"An Aggregated Signature is comprised of which three components?"})}),"\n",(0,t.jsxs)(n,{children:[(0,t.jsx)("summary",{children:" Answer (expand when ready to see the answer) "}),(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"AGG_SIG_ME"})," condition expects a concatenated value of the following:"]}),(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"The conditions treehash."}),"\n",(0,t.jsx)(s.li,{children:"The coin ID."}),"\n",(0,t.jsx)(s.li,{children:"The genesis challenge."}),"\n"]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,t.jsx)(s.h3,{id:"runnable-chialisp-and-clvm-plugins",children:"Runnable Chialisp and clvm plugins"}),"\n",(0,t.jsxs)(s.p,{children:["For information on using these plugins please refer to the ",(0,t.jsx)(s.a,{href:"/academy-overview#runnable-chialisp-and-clvm-plugins",children:"academy overview"})]}),"\n",(0,t.jsx)(s.h4,{id:"chialisp-plugin",children:"Chialisp plugin"}),"\n",(0,t.jsx)(r.Z,{flavor:"chialisp",input:"(10 99)",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-chialisp",children:'(mod (arg1 arg2)\n    (if (> (+ arg1 arg2) 100) "large" "small")\n)\n'})})}),"\n",(0,t.jsx)(s.h4,{id:"clvm-plugin",children:"Clvm plugin"}),"\n",(0,t.jsx)(r.Z,{flavor:"clvm",input:"(1)",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-chialisp",children:'(a (i 2 (q 1 . "true") (q 1 . "false")) 1)\n'})})}),"\n",(0,t.jsx)(s.h3,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["General ",(0,t.jsx)(s.a,{href:"https://docs.chia.net/guides/chialisp-concepts",children:"chialisp concepts"}),": overviews of currying, inner puzzles, and morphing conditions."]}),"\n",(0,t.jsxs)(s.li,{children:["Guided ",(0,t.jsx)(s.a,{href:"https://docs.chia.net/guides/",children:"chialisp walkthroughs"}),": guides for installation, creating smart coins, and working with BLS signatures."]}),"\n",(0,t.jsxs)(s.li,{children:["Chialisp ",(0,t.jsx)(s.a,{href:"https://chialisp.com/",children:"detailed documentation"}),": detailed information on all aspects of chialisp."]}),"\n",(0,t.jsxs)(s.li,{children:["Support ",(0,t.jsx)(s.a,{href:"https://discord.gg/chia",children:"in discord"}),": for further support join our discord server and ask in the #chialisp or #support channels."]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{})]})}function u(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},773:(e,s,n)=>{"use strict";n.d(s,{Z:()=>w});var t=n(2949),i=n(5356),r=n(2573),o=n(7294),l=n(4066),a=n(460),c=n.n(a),h=n(9042),d=n.n(h),u=n(23),p=n.n(u);function g(e){return e instanceof Array||(0,o.isValidElement)(e)?o.Children.toArray(e).reduce(((e,s)=>{let n="";return n=(0,o.isValidElement)(s)&&x(s)?g(s.props.children):(0,o.isValidElement)(s)&&!x(s)?"":m(s),e.concat(n)}),""):m(e)}function m(e){return null==e||"boolean"==typeof e||"{}"===JSON.stringify(e)?"":e.toString()}function x(e){return(0,o.isValidElement)(e)&&Boolean(e.props.children)}var j=n(5893);function w(e){let{children:s,flavor:n,input:a,tests:c,reporter:h}=e;const{colorMode:u}=(0,t.I)(),m=(0,o.useMemo)((()=>g(s).trim()),[]),[x,w]=(0,o.useState)(m),[y,b]=(0,o.useState)(a??Object.keys(c??{})[0]?.trim()??""),[v,k]=(0,o.useState)(""),[S,z]=(0,o.useState)(0n),[C,T]=(0,o.useState)(null),I=e=>e.replace("Error: ",""),A=(e,s)=>{try{return e.run(s)}catch(n){return k(`While evaluating: ${I(""+n)}`),null}},E=()=>{const e=(()=>{try{return i.Program.fromSource(x)}catch(e){return k(`While parsing: ${I(""+e)}`),null}})();if(!e)return;const s="clvm"===n||e.isCons&&e.first.equals(i.Program.fromText("mod")),t=(e=>{if(n&&"chialisp"!==n)return e;try{return e.compile().value}catch(s){return k(`While compiling: ${I(""+s)}`),null}})(e);if(!t)return;const r=y?i.Program.fromSource(y):i.Program.nil,o=s?A(t,r):{value:t,cost:0n};o&&(k(o.value.toSource()),z(o.cost));let l=!0;for(const[n,a]of Object.entries(c??{})){const e=i.Program.fromSource(n),r=s?A(t,e)?.value:t;if(!r||r.toSource()!==a){l=!1;break}}h?.(l),T(l)},N=C?l.l_A:l.aHS,[F,_]=o.useState(!1);return(0,o.useEffect)((()=>_(!0)),[]),(0,j.jsx)(r.y$,{Prism:globalThis.Prism,theme:F&&("dark"===u?d():p()),code:x,language:"chialisp",children:e=>{let{className:s,style:t}=e;return(0,j.jsxs)("pre",{className:s,style:{...t,position:"relative"},children:[y?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f,{code:y,setCode:b,language:"chialisp"}),(0,j.jsx)("hr",{style:{marginTop:"14px",marginBottom:"14px"}})]}):"",(0,j.jsx)(f,{code:x,setCode:w,language:"chialisp"}),(0,j.jsx)("div",{style:{position:"absolute",top:"16px",right:"16px"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"14px"},children:[(0,j.jsx)("span",{style:{marginRight:"8px"},children:n&&"chialisp"!==n?"CLVM":"Chialisp"}),!y&&(0,j.jsx)(l.A0H,{size:24,className:"icon-button",cursor:"pointer",onClick:()=>b("()")}),(0,j.jsx)(l.gmG,{size:24,className:"icon-button",cursor:"pointer",onClick:E})]})}),v?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("hr",{style:{marginTop:"14px",marginBottom:"14px"}}),(0,j.jsx)("div",{style:{display:"inline-block"},children:(0,j.jsx)(f,{code:v,language:"chialisp"})}),v&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{style:{display:"inline-block",position:"absolute",right:"60px"},children:(0,j.jsx)(f,{code:`Cost: ${S}`,language:"chialisp"})}),(0,j.jsx)(N,{size:24,color:C?"#77FF77":"#FF7777",style:{position:"absolute",bottom:"16px",right:"16px"}})]})]}):""]})}})}function f(e){let{code:s,setCode:n,language:i}=e;const{colorMode:l}=(0,t.I)(),[a,h]=o.useState(!1);return(0,o.useEffect)((()=>h(!0)),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(r.y$,{Prism:globalThis.Prism,theme:a&&("dark"===l?d():p()),code:s,language:i,children:e=>{let{tokens:t,getLineProps:i,getTokenProps:r}=e,o=t.map(((e,s)=>(0,j.jsx)("div",{...i({line:e}),children:e.map(((e,s)=>(0,j.jsx)("span",{...r({token:e})},s)))},s)));return n?(0,j.jsx)(c(),{value:s,onValueChange:e=>n(e),highlight:()=>o,padding:0}):o}})})}},9042:e=>{e.exports={plain:{color:"#F8F8F2",backgroundColor:"#282A36",fontWeight:"bold"},styles:[{types:["keyword"],style:{color:"rgb(189, 147, 249)"}},{types:["listop","class-name","quotes"],style:{color:"rgb(80, 250, 123)"}},{types:["builtin"],style:{color:"rgb(5, 227, 223)"}},{types:["number","hexadecimal","string","boolean"],style:{color:"rgb(255, 184, 108)",fontWeight:"normal"}},{types:["punctuation","symbol"],style:{color:"rgb(248, 248, 242)"}},{types:["variable"],style:{fontStyle:"italic"}},{types:["comment"],style:{color:"rgb(98, 114, 164)",fontWeight:"normal"}},{types:["function","car"],style:{color:"rgb(241, 250, 140)"}}]}},23:e=>{e.exports={plain:{color:"#383a42",backgroundColor:"#fafafa",fontWeight:"bold"},styles:[{types:["keyword"],style:{color:"#990096"}},{types:["listop","class-name","quotes"],style:{color:"#006100"}},{types:["builtin"],style:{color:"#127EAF"}},{types:["number","hexadecimal","string","boolean"],style:{color:"#B35C00",fontWeight:"normal"}},{types:["punctuation","symbol"],style:{color:"#383a42"}},{types:["variable"],style:{fontStyle:"italic"}},{types:["comment"],style:{color:"#73737D",fontWeight:"normal"}},{types:["function","car"],style:{color:"#0045DB"}}]}}}]);
"use strict";(self.webpackChunkchia_docs=self.webpackChunkchia_docs||[]).push([[9427],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var o=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,o,n=function(e,t){if(null==e)return{};var a,o,n={},l=Object.keys(e);for(o=0;o<l.length;o++)a=l[o],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)a=l[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var r=o.createContext({}),c=function(e){var t=o.useContext(r),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return o.createElement(r.Provider,{value:t},e.children)},p="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,r=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(a),h=n,d=p["".concat(r,".").concat(h)]||p[h]||f[h]||l;return a?o.createElement(d,i(i({ref:t},u),{},{components:a})):o.createElement(d,i({ref:t},u))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,i=new Array(l);i[0]=h;var s={};for(var r in t)hasOwnProperty.call(t,r)&&(s[r]=t[r]);s.originalType=e,s[p]="string"==typeof e?e:n,i[1]=s;for(var c=2;c<l;c++)i[c]=a[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,a)}h.displayName="MDXCreateElement"},9671:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>r,contentTitle:()=>i,default:()=>f,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var o=a(7462),n=(a(7294),a(3905));const l={id:"custom-puzzle-lock",slug:"/guides/custom-puzzle-lock-tutorial",title:"Custom Puzzle Lock"},i=void 0,s={unversionedId:"guides/tutorials/custom-puzzle-lock",id:"guides/tutorials/custom-puzzle-lock",title:"Custom Puzzle Lock",description:"This tutorial teaches you how to lock a coin with a custom-made puzzle.",source:"@site/docs/guides/tutorials/custom-puzzle-lock.md",sourceDirName:"guides/tutorials",slug:"/guides/custom-puzzle-lock-tutorial",permalink:"/guides/custom-puzzle-lock-tutorial",draft:!1,editUrl:"https://github.com/Chia-Network/chia-docs/blob/main/docs/guides/tutorials/custom-puzzle-lock.md",tags:[],version:"current",frontMatter:{id:"custom-puzzle-lock",slug:"/guides/custom-puzzle-lock-tutorial",title:"Custom Puzzle Lock"},sidebar:"guides",previous:{title:"Multiple Issuance CAT",permalink:"/guides/multiple-issuance-cat-video-series"},next:{title:"RPC Coin Spend",permalink:"/guides/coin-spend-rpc-tutorial"}},r={},c=[{value:"Create a puzzle",id:"create-a-puzzle",level:2},{value:"Get compiled version of the custom puzzle",id:"get-compiled-version-of-the-custom-puzzle",level:2},{value:"Using clvm_tools (official)",id:"using-clvm_tools-official",level:3},{value:"Using Chialisp web tool (unofficial)",id:"using-chialisp-web-tool-unofficial",level:3},{value:"Get puzzle hash from a puzzle",id:"get-puzzle-hash-from-a-puzzle",level:2},{value:"Using clvm_tools",id:"using-clvm_tools",level:3},{value:"Using Chialisp",id:"using-chialisp",level:3},{value:"Convert puzzle hash to a receive address",id:"convert-puzzle-hash-to-a-receive-address",level:2},{value:"Send Chia to the receive address",id:"send-chia-to-the-receive-address",level:2}],u={toc:c},p="wrapper";function f(e){let{components:t,...a}=e;return(0,n.kt)(p,(0,o.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This tutorial teaches you how to lock a coin with a custom-made puzzle."),(0,n.kt)("h2",{id:"create-a-puzzle"},"Create a puzzle"),(0,n.kt)("p",null,"Create whatever puzzle you want for your coin. We'll use a password-locked coin as an example for this tutorial."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-chialisp"},"(mod (password new_puzhash amount)\n    (defconstant CREATE_COIN 51)\n\n    (if (= (sha256 password) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824))\n        (list (list CREATE_COIN new_puzhash amount))\n        (x)\n    )\n)\n")),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824")," is the sha256 hash of the word ",(0,n.kt)("inlineCode",{parentName:"p"},"hello"),"."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example valid solution:")," ",(0,n.kt)("inlineCode",{parentName:"p"},"(hello 0x5f5767744f91c1c326d927a63d9b34fa7035c10e3eb838c44e3afe127c1b7675 2)"),"."),(0,n.kt)("p",null,"If password is correct, the puzzle will create a new coin with 2 mojos and lock it using a new puzzle hash ",(0,n.kt)("inlineCode",{parentName:"p"},"0x5f5767744f91c1c326d927a63d9b34fa7035c10e3eb838c44e3afe127c1b7675"),"."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Any remaining change goes to a farmer as a fee"),"."),(0,n.kt)("h2",{id:"get-compiled-version-of-the-custom-puzzle"},"Get compiled version of the custom puzzle"),(0,n.kt)("p",null,"There are multiple ways how you can get compiled version of your custom puzzle."),(0,n.kt)("h3",{id:"using-clvm_tools-official"},"Using ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/Chia-Network/clvm_tools"},"clvm_tools")," (official)"),(0,n.kt)("p",null,"You can compile your custom puzzle from the terminal using the clvm_tools repository (included in the official Chia repository). All you need to do is to use the ",(0,n.kt)("inlineCode",{parentName:"p"},"run")," command with your puzzle provided as an argument."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"run '(mod (password new_puzhash amount)\n    (defconstant CREATE_COIN 51)\n\n    (if (= (sha256 password) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824))\n        (list (list CREATE_COIN new_puzhash amount))\n        (x)\n    )\n)'\n")),(0,n.kt)("p",null,"results in ",(0,n.kt)("inlineCode",{parentName:"p"},"(a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1))"),"."),(0,n.kt)("h3",{id:"using-chialisp-web-tool-unofficial"},"Using ",(0,n.kt)("a",{parentName:"h3",href:"https://clisp.surrealdev.com/"},"Chialisp web tool")," (unofficial)"),(0,n.kt)("p",null,"Paste your custom puzzle into the text area and hit ",(0,n.kt)("strong",{parentName:"p"},"Compile"),". The compiled version will appear in the ",(0,n.kt)("strong",{parentName:"p"},"Run Output")," section."),(0,n.kt)("h2",{id:"get-puzzle-hash-from-a-puzzle"},"Get puzzle hash from a puzzle"),(0,n.kt)("h3",{id:"using-clvm_tools"},"Using ",(0,n.kt)("a",{parentName:"h3",href:"https://github.com/Chia-Network/clvm_tools"},"clvm_tools")),(0,n.kt)("p",null,"You can get the hash of your Chialisp puzzle with the ",(0,n.kt)("inlineCode",{parentName:"p"},"opc -H <compiled_puzzle>")," command included in the official clvm_tools repository."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"opc -H '(a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1))'\n")),(0,n.kt)("p",null,"The response of this command will be a puzzle hash ",(0,n.kt)("strong",{parentName:"p"},"on the first line")," and a serialized version of your puzzle on the second line."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example response:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71\nff02ffff01ff02ffff03ffff09ffff0bff0580ffff01a02cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b982480ffff01ff04ffff04ff02ffff04ff0bffff04ff17ff80808080ff8080ffff01ff088080ff0180ffff04ffff0133ff018080\n")),(0,n.kt)("p",null,"As you can see from the first line of this response, puzzle hash for our custom puzzle is ",(0,n.kt)("inlineCode",{parentName:"p"},"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71")),(0,n.kt)("h3",{id:"using-chialisp"},"Using Chialisp"),(0,n.kt)("p",null,"You can also use Chialisp itself to get the hash of the Chialisp puzzle. The puzzle to get a puzzle hash is following:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-chialisp"},"(mod (puzzle)\n    (defconstant TREE 1)\n\n    (defun sha256tree1 (TREE)\n       (if (l TREE)\n           (sha256 2 (sha256tree1 (f TREE)) (sha256tree1 (r TREE)))\n           (sha256 1 TREE)\n       )\n    )\n\n    (sha256tree1 puzzle)\n)\n")),(0,n.kt)("p",null,"A solution to this puzzle then needs to contain the compiled puzzle we want to hash in the first position (wrap the compiled puzzle with parentheses and provide it as a solution)."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example solution for the password-locked coin:"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"((a (q 2 (i (= (sha256 5) (q . 0x2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824)) (q 4 (c 2 (c 11 (c 23 ()))) ()) (q 8)) 1) (c (q . 51) 1)))")),(0,n.kt)("p",null,"The resulting hash for this example puzzle is again ",(0,n.kt)("inlineCode",{parentName:"p"},"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71"),"."),(0,n.kt)("h2",{id:"convert-puzzle-hash-to-a-receive-address"},"Convert puzzle hash to a receive address"),(0,n.kt)("p",null,"You can convert a puzzle hash to a receive address and vice-versa. An address is just an encoded puzzle hash. And since a puzzle hash matches specific puzzle, it also means that a receive address matches a specific puzzle."),(0,n.kt)("p",null,"You can use an online tool from ",(0,n.kt)("a",{parentName:"p",href:"https://www.spacescan.io/tools/puzzlehashconverter"},"spacescan.io")," for converting between puzzle hash to receive address. The puzzle hash is encoded to bech32m format with xch prefix to form a receive address. The receive address for the puzzle hash ",(0,n.kt)("inlineCode",{parentName:"p"},"0x4843c869bba5f65aa1e806cd372dae5668ca3b69640d067e86837ca96b324e71")," is ",(0,n.kt)("inlineCode",{parentName:"p"},"xch1fppus6dm5hm94g0gqmxnwtdw2e5v5wmfvsxsvl5xsd72j6ejfecsdnkf2e"),"."),(0,n.kt)("h2",{id:"send-chia-to-the-receive-address"},"Send Chia to the receive address"),(0,n.kt)("p",null,"Use the Chia GUI or CLI to send a transaction as you would typically do with the amount you want. As a receive address, set the address from the previous step (password-locked coin example: ",(0,n.kt)("inlineCode",{parentName:"p"},"xch1fppus6dm5hm94g0gqmxnwtdw2e5v5wmfvsxsvl5xsd72j6ejfecsdnkf2e"),"). That will lock your coin with a new puzzle."),(0,n.kt)("hr",null),(0,n.kt)("p",null,"If you have further questions, join our ",(0,n.kt)("a",{parentName:"p",href:"https://keybase.io/team/chia_network.public"},"Keybase team")," and ask in the ",(0,n.kt)("em",{parentName:"p"},"#chialisp")," channel."))}f.isMDXComponent=!0}}]);
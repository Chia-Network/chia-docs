<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/custody/custody-tool-description" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Custody Tool Description | Chia Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" name="twitter:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" property="og:url" content="https://docs.chia.net/zh/guides/custody-tool-description"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Custody Tool Description | Chia Documentation"><meta data-rh="true" name="description" content="The majority of Chia Network Inc&#x27;s prefarm is being held in a cold wallet, secured by a complex set of custodial rules. This document will describe the details of the custodial arrangement. A moderate level of technical proficiency is probably needed to understand the details. For a high-level overview of the custody wallet, see our blog post."><meta data-rh="true" property="og:description" content="The majority of Chia Network Inc&#x27;s prefarm is being held in a cold wallet, secured by a complex set of custodial rules. This document will describe the details of the custodial arrangement. A moderate level of technical proficiency is probably needed to understand the details. For a high-level overview of the custody wallet, see our blog post."><link data-rh="true" rel="icon" href="/zh/svg/chia-leaf-green.svg"><link data-rh="true" rel="canonical" href="https://docs.chia.net/zh/guides/custody-tool-description"><link data-rh="true" rel="alternate" href="https://docs.chia.net/guides/custody-tool-description" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.chia.net/zh/guides/custody-tool-description" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.chia.net/guides/custody-tool-description" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/zh/assets/css/styles.7391c56e.css">
<link rel="preload" href="/zh/assets/js/runtime~main.668644d3.js" as="script">
<link rel="preload" href="/zh/assets/js/main.a1d7c8f7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Chia Docs</b></a><a class="navbar__item navbar__link" href="/zh/introduction">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/guides/crash-course/introduction">Guides</a><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chialisp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Network<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chia-blockchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/zh/guides/crash-course/introduction">Crash Course</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/intro-to-chialisp">Chialisp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/smart-coins">Smart Coins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/signatures">Signatures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/state">State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/inner-puzzles">Inner Puzzles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/cats-offers-nfts">CATs, Offers and NFTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/chialisp-and-typescript">Chialisp and TypeScript</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/chialisp-primer">Chialisp Primer</a><button aria-label="打开/收起侧边栏菜单「Chialisp Primer」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/chialisp-concepts">Chialisp Concepts</a><button aria-label="打开/收起侧边栏菜单「Chialisp Concepts」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/nft-developer-guide">NFT Guide</a><button aria-label="打开/收起侧边栏菜单「NFT Guide」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/cat-developer-guide">CAT Guide</a><button aria-label="打开/收起侧边栏菜单「CAT Guide」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/guides/custody-tool-description">Custody Tool</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/guides/custody-tool-description">Custody Tool Description</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/custody-tool-user-guide">Custody Tool User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/custody/prefarm-audit-tutorial">Prefarm Audit Tutorial</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/walletconnect-user-guide">WalletConnect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/datalayer-user-guide">DataLayer™</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/clawback-user-guide">Clawback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/offers-gui-tutorial">Offers</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/simulator-user-guide">Simulator User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/seeder-user-guide">Seeder User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/verifiable-credentials-guide">Verifiable Credentials Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/why-chia-is-great-video-series">Tutorials</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Custody Tool</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Custody Tool Description</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Custody Tool Description</h1></header><p>The majority of Chia Network Inc&#x27;s prefarm is being held in a cold wallet, secured by a complex set of custodial rules. This document will describe the details of the custodial arrangement. A moderate level of technical proficiency is probably needed to understand the details. For a high-level overview of the custody wallet, see our <a href="https://www.chia.net/2022/10/29/a-new-home-for-the-prefarm/" target="_blank" rel="noopener noreferrer">blog post</a>.</p><p>Other relevant documents:</p><ul><li><a target="_blank" href="/zh/assets/files/chia-custody-tool-5e6e2f18e8f98c0faaf11bdf5fea5971.png">Flow chart</a> to visualize how the custody tool works</li><li><a href="/zh/guides/custody-tool-user-guide">User guide</a> to help you get up and running</li><li><a href="/zh/custody-tool">CLI reference</a> for all custody commands used in this tutorial</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="singleton-structure">Singleton Structure<a href="#singleton-structure" class="hash-link" aria-label="Singleton Structure的直接链接" title="Singleton Structure的直接链接">​</a></h2><p>The prefarm uses a <a href="https://chialisp.com/singletons" target="_blank" rel="noopener noreferrer" title="Description of Chia singletons">singleton</a> with the following features:</p><ol><li><strong>Multisig</strong> -- required to perform actions on the singleton, where:</li></ol><ul><li>The total number of keys in the multisig is initially set to 5, which will be referred to as <code>n</code> for the rest of this document. <code>n</code> can be changed with a rekey (explained later)</li><li>Initially, 3 keys will be required to perform withdrawals and standard rekeys. This number will be referred to as <code>m</code> for the rest of this document. <code>m</code> can be thought of as the <em>security level</em> for the wallet. This variable can be modified to be as large as <code>n</code>. For the prefarm, it can be as small as 1, though other custodial wallets could set the minimum to a larger number</li></ul><ol start="2"><li><strong>Merkle root</strong> -- Chialisp puzzles representing the <code>n</code> keys are stored in a Merkle tree, where:</li></ol><ul><li>Puzzles representing every combination of keys, from 1 to <code>m</code>, are stored. If the keys are A, B, C, D and E, and <code>m</code> is 3, then the combinations to be stored are ABC, ABD, ABE, ACD, ACE, ADE, BCD, BCE, BDE, CDE, AB, AC, AD, AE, BC, BD, BE, CD, CE, DE, A, B, C, D and E</li><li>The Merkle root of this tree is curried (pre-committed) into the singleton</li><li>The Merkle root of a tree containing puzzles of all possible combinations for <code>m</code> + 1 is also curried into the singleton. This is required in case of a lock level increase (explained later). This root is recursive, in that it contains puzzles that have combinations for <code>m</code> + 2 committed to them, leading up to the level where <code>m</code> = <code>n</code>.</li><li>In order to spend a coin from this wallet, a node in the Merkle tree, along with a Proof of Inclusion, are required to be passed into the singleton&#x27;s solution. The Proof of Inclusion must prove the node&#x27;s existence in the current Merkle root in order for the spend to succeed</li><li>The Merkle tree is stored in multiple private locations. However, even if a copy is stolen, the thief will not gain access to the wallet because <code>m</code> digital signatures are still required (see below for a more detailed analysis)</li><li>The Merkle tree is generated deterministically, based on the <code>n</code> pubkeys. Therefore, if the Merkle tree is lost, it can be regenerated by using the <code>n</code> pubkeys</li></ul><ol start="3"><li><p><strong>Withdrawal Timelock</strong> -- This is a timelock on initiating a withdrawal, referred to as <code>wt</code> for the rest of this document. The value of <code>wt</code> is set upon the wallet&#x27;s creation and can never be changed. It will be explained in detail below.</p></li><li><p><strong>Rekey Timelock</strong> -- This is a timelock on initiating a rekey, referred to as <code>rt</code> for the rest of this document. The value of <code>rt</code> is set upon the wallet&#x27;s creation and can never be changed. It will be explained in detail below.</p></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="singleton-settings">Singleton Settings<a href="#singleton-settings" class="hash-link" aria-label="Singleton Settings的直接链接" title="Singleton Settings的直接链接">​</a></h2><p>The singleton comes in two layers -- one permanent and one non-permanent.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="permanent-layer">Permanent layer<a href="#permanent-layer" class="hash-link" aria-label="Permanent layer的直接链接" title="Permanent layer的直接链接">​</a></h3><table><thead><tr><th align="left">Setting</th><th align="left">Prefarm Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>wt</code></td><td align="left">30 days</td><td align="left">Withdrawal Timelock -- When attempting to begin a withdrawal, this is the minimum number of seconds that must have elapsed since the last withdrawal, rekey or clawback.</td></tr><tr><td align="left"><code>pc</code></td><td align="left">90 days</td><td align="left">Payment Clawback -- The minimum number of seconds that must elapse after initiating a withdrawal before the withdrawal can be completed. Clawbacks are possible during this window.</td></tr><tr><td align="left"><code>rt</code></td><td align="left">15 days</td><td align="left">Rekey Timelock -- When attempting to begin a standard rekey, this is the minimum number of seconds that must have elapsed since the last withdrawal, rekey or clawback. For a slow rekey, this amount gets added for each key less than <code>m</code> (in addition to the amount of time that would have been required in a standard rekey).</td></tr><tr><td align="left"><code>rc</code></td><td align="left">30 days</td><td align="left">Rekey Clawback -- The minimum number of seconds that must elapse after initiating a rekey before the rekey can be completed. Clawbacks are possible during this window.</td></tr><tr><td align="left"><code>sp</code></td><td align="left">45 days</td><td align="left">Slow rekey Penalty -- This amount gets added to the Rekey Timelock when a slow rekey is being performed.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-permanent-layer">Non-permanent layer<a href="#non-permanent-layer" class="hash-link" aria-label="Non-permanent layer的直接链接" title="Non-permanent layer的直接链接">​</a></h3><table><thead><tr><th align="left">Setting</th><th align="left">Initial<br>Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>m</code></td><td align="left">3</td><td align="left">The initial number of pubkeys required to do a withdrawal or standard rekey</td></tr><tr><td align="left"><code>n</code></td><td align="left">5</td><td align="left">The maximum number of pubkeys required to do a withdrawal or standard rekey</td></tr><tr><td align="left"><code>pks</code></td><td align="left"></td><td align="left">A comma separated list of pubkey files that will control this money</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="allowed-actions">Allowed Actions<a href="#allowed-actions" class="hash-link" aria-label="Allowed Actions的直接链接" title="Allowed Actions的直接链接">​</a></h2><p>Three separate actions are allowed on the wallet&#x27;s singleton: withdrawals, rekeys (normal and slow) and lock level increases. Each of these actions will be discussed in detail in this section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="withdrawal">Withdrawal<a href="#withdrawal" class="hash-link" aria-label="Withdrawal的直接链接" title="Withdrawal的直接链接">​</a></h3><p>This action removes money from the wallet. In order for a withdrawal to be initiated, exactly <code>m</code> of <code>n</code> signatures are required.</p><p>Two phases must be completed to perform a withdrawal: a <em>withdrawal timelock</em> and a <em>drop coin</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="withdrawal-timelock">Withdrawal Timelock<a href="#withdrawal-timelock" class="hash-link" aria-label="Withdrawal Timelock的直接链接" title="Withdrawal Timelock的直接链接">​</a></h4><p>Even though this is called a <em>timelock</em>, it acts more like a <em>gateway</em>, which either allows or disallows the singleton to begin the withdrawal process. It has the following rules:</p><ul><li><code>wt</code> seconds must have elapsed since any actions (other than a lock level increase) have been performed on the singleton</li><li>The <code>wt</code> condition either has, or has not, been met</li><li><code>wt</code> is part of the singleton&#x27;s permanent layer, so it can never be modified</li></ul><p>If the withdrawal timelock condition has not been met, then a withdrawal may not be initiated. If it has been met, then a withdrawal may be initiated. The next phase is the <em>drop coin</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="drop-coin">Drop Coin<a href="#drop-coin" class="hash-link" aria-label="Drop Coin的直接链接" title="Drop Coin的直接链接">​</a></h4><p>Upon entering this phase, the singleton creates a <em>drop coin</em> of the amount of XCH to be withdrawn. A drop coin has several rules:</p><ul><li>It has a curried XCH payout address, to where the money is flagged to be withdrawn</li><li>It has a payment clawback timelock, referred to as <code>pc</code> for the rest of this document</li><li>Because the drop coin cannot be spent for <code>pc</code> seconds, it functions as a permissionless escrow</li><li>The drop coin contains the same Merkle root that was used in the singleton</li><li>At any point before the drop coin has been spent, <em>clawback</em> is allowed. Clawback has the following features:<ul><li>It cancels the withdrawal and returns the money to the custodial wallet&#x27;s singleton. It uses <code>p2_singleton</code> to accomplish this, so there is further action needed for the funds to be absorbed into the singleton</li><li>It requires <code>m</code> of <code>n</code> signatures</li><li>The <code>m</code> signatures don&#x27;t have to be the same as the ones that initiated the withdrawal. In other words, different people could claw back the withdrawal than those who initiated it</li></ul></li><li>After <code>pc</code> seconds, if a clawback has not been performed, <em>completion</em> becomes possible. Completion has the following features:<ul><li>It completes the withdrawal to a pre-specified XCH address</li><li><strong>Anyone</strong> is allowed to perform a completion</li><li>Even though a completion can be performed by anyone, it is secure because the withdrawal address is not changeable</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rekey">Rekey<a href="#rekey" class="hash-link" aria-label="Rekey的直接链接" title="Rekey的直接链接">​</a></h3><p>This action changes the keys associated with the wallet&#x27;s singleton.</p><p><code>k</code> keys are required for a rekey, where:</p><ul><li>For a <em>standard</em> rekey, <code>k = m</code></li><li>For a <em>slow</em> rekey, <code>1 &lt;= k &lt; m</code>. (By default, a slow rekey could be performed with just one key.)</li></ul><p>Either type of rekey can also modify <code>m</code> and/or <code>n</code> if desired. We&#x27;ll discuss the circumstances where each type of rekey will be performed later in this section.</p><p>Two phases must be completed to perform a rekey, an <em>initiation timelock</em> and a <em>drop coin</em>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="initiation">Initiation<a href="#initiation" class="hash-link" aria-label="Initiation的直接链接" title="Initiation的直接链接">​</a></h4><p>Before a rekey can begin, a certain amount of time must have elapsed since the last action (other than a lock level increase) was performed on the singleton. This is a <em>de facto</em> gateway; the time condition either has, or has not been met.</p><p>The amount of time before the rekey can begin depends on the number of keys used. In order to calculate this time, several factors must be considered:</p><ul><li>Start by calculating <code>x</code>, where <code>x = m - k + 1</code><ul><li>If <code>x</code> is <code>1</code>, then it&#x27;s a standard rekey (<code>k = m</code>)</li><li>If <code>x &gt; 1</code>, then it&#x27;s a slow rekey. <code>x</code> represents the gap between the <code>k</code> keys being used with this rekey and <code>m + 1</code> (the number of keys required for a lock level increase, as explained below)</li></ul></li><li>For a standard rekey, the initiation timelock duration is <code>rt</code>. As discussed above, <code>rt</code> is stored in the singleton and can never be changed</li><li>For a slow rekey, a time penalty <code>sp</code> seconds is automatically applied. The value of <code>sp</code> also can never be changed</li><li>The duration of the initiation timelock of a slow rekey is <code>sp + rt*x</code> seconds. In other words, a penalty of <code>rt</code> seconds gets added for each key less than <code>m</code></li></ul><p>The following table illustrates a few examples of initiation timelock lengths, for various values of <code>m</code> and <code>k</code>. For this table, <code>rt</code> is set to 15 days and <code>sp</code> is set to 45 days (these are both denominated in seconds). The table assumes that <code>n</code> (5) and the minimum <code>k</code> (1) have not been modified from their default values:</p><table><thead><tr><th align="center"><code>m</code></th><th align="center"><code>k</code></th><th align="center">Days</th><th align="left">Comment</th></tr></thead><tbody><tr><td align="center">3</td><td align="center">3</td><td align="center">15</td><td align="left">Standard rekey, no penalty</td></tr><tr><td align="center">3</td><td align="center">2</td><td align="center">75</td><td align="left">Slow rekey, <code>sp</code> day penalty + 2 <!-- -->*<!-- --> standard <code>rt</code> days</td></tr><tr><td align="center">3</td><td align="center">1</td><td align="center">90</td><td align="left">Slow rekey, <code>sp</code> day penalty + 3 <!-- -->*<!-- --> <code>rt</code> days</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">15</td><td align="left">This is a case where, after a prior rekey, <code>m</code> was reduced to 1. There is no penalty, even with a single key</td></tr><tr><td align="center">5</td><td align="center">3</td><td align="center">90</td><td align="left">In this case, a lock level increase has been performed, so 5 of 5 keys are required to avoid a penalty</td></tr><tr><td align="center">5</td><td align="center">1</td><td align="center">120</td><td align="left">This is the longest possible initiation timelock duration when <code>n</code> is 5 and the minimum <code>k</code> is 1. In this case, <code>m</code> has been increased to 5, and 1 key is being used for the rekey</td></tr><tr><td align="center">...</td><td align="center">...</td><td align="center">...</td><td align="left">Other combinations for <code>m</code> and <code>k</code> are possible, but not shown here</td></tr></tbody></table><p>If the singleton has been modified within the timelock&#x27;s required number of seconds, then the initiation timelock condition has not been met, and a rekey may not be initiated. If the initiation timelock condition has been met, then a withdrawal may be initiated. The next phase is the <em>drop coin</em>. <code>k</code> is carried over to this phase.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="drop-coin-1">Drop Coin<a href="#drop-coin-1" class="hash-link" aria-label="Drop Coin的直接链接" title="Drop Coin的直接链接">​</a></h4><p>Upon entering this phase, the singleton creates a <em>drop coin</em> with 0 value. This drop coin has several rules:</p><ul><li>It has a hard-coded timelock, hereafter referred to as <code>rc</code></li><li>The same Merkle root that was used in the singleton is curried into the drop coin</li><li>A new Merkle root is also curried into the drop coin. After the rekey has completed, this will become the Merkle root of the puzzles representing the new keys. Therefore, the new keys, along with the new Merkle tree, must have been generated before the drop coin was created</li><li>At any point before the drop coin has been spent, <em>clawback</em> is allowed. Clawback has the following features:<ul><li>It cancels the rekey; the custodial wallet&#x27;s singleton is left unmodified</li><li>It requires <code>k</code> signatures (the number of keys that initiated the rekey)</li><li>The <code>k</code> signatures don&#x27;t have to be the same as the ones that initiated the rekey. In other words, different people could claw back the rekey than those who initiated it</li></ul></li><li>After <code>rc</code> seconds, if a clawback has not been performed, <em>completion</em> becomes possible. Completion has the following features:<ul><li>It spends the drop coin, which creates a puzzle announcement for the singleton to use</li><li>It also spends the singleton, which asserts the puzzle announcement from the drop coin, and recreates itself with the new Merkle root curried in</li><li><code>m</code> and/or <code>n</code> could be set to different numbers in the new singleton</li><li><strong>Anyone</strong> is allowed to perform the completion</li><li>Even though the completion can be performed by anyone, it is secure because the new Merkle root has already been committed to</li></ul></li></ul><p>Note that because <code>rc</code> is hard-coded, a second rekey can&#x27;t overtake a rekey that has already been initiated. If rekey A is in progress and someone attempts rekey B, then A will succeed and B will fail.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lock-level-increase">Lock Level Increase<a href="#lock-level-increase" class="hash-link" aria-label="Lock Level Increase的直接链接" title="Lock Level Increase的直接链接">​</a></h3><p>This action increases the wallet&#x27;s security (<code>m</code>) by 1. It has the following features:</p><ul><li><code>m + 1</code> keys are required to perform a lock level increase</li><li>The effect is immediate -- there is no timelock</li><li>The keys themselves don&#x27;t change</li><li>This action is secure because the new Merkle root has been pre-committed</li><li>In running this action, the singleton is spent and a new copy is created, with a new Merkle root curried in. This new root is taken from a Merkle tree containing every possible combination of keys from the new <code>m</code> down to 1</li><li>This action automatically invalidates all outstanding rekey attempts because the Merkle root has changed in the new copy of the singleton</li><li>This action does <em>not</em> invalidate outstanding withdrawal attempts</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="when-are-normal-rekey-slow-rekey-and-lock-level-increase-needed">When are Normal Rekey, Slow Rekey and Lock Level Increase needed?<a href="#when-are-normal-rekey-slow-rekey-and-lock-level-increase-needed" class="hash-link" aria-label="When are Normal Rekey, Slow Rekey and Lock Level Increase needed?的直接链接" title="When are Normal Rekey, Slow Rekey and Lock Level Increase needed?的直接链接">​</a></h3><p>Normally, each of the keys will be in a Secure state. This means that the original owner still possesses the key, and no adversaries have gained access to it.</p><p>Keys have three other possible states:</p><ul><li>Sniffed -- An adversary has gained access to the key. The owner still has a copy</li><li>Stolen -- An adversary has gained access to the key. The owner no longer has a copy</li><li>Lost -- The owner has lost the key. Nobody else has gained access to it</li></ul><p>If a sufficient number of keys are sniffed, stolen or lost, there are three potential catastrophic consequences:</p><ul><li>Deadlocked -- The owner and adversary each attempt to rekey and claw back those attempts. Neither side obtains the funds until the other side gives up</li><li>Drained -- An adversary is able to steal the funds</li><li>Bricked -- Nobody is able to access the funds</li></ul><p>Any time one or more keys have been sniffed, stolen or lost, a rekey will be performed if possible.</p><p>The Merkle tree is needed to perform withdrawals, rekeys and lock level increases. Multiple copies of the tree will be kept in private locations. The assumption is that if any of the keys are sniffed, stolen or lost, the Merkle tree has been sniffed.</p><p>The following table lists the action/consequence, given the current value of <code>m</code> and the state of the keys:</p><br><table><thead><tr><th align="left"><code>m</code></th><th align="left">Keys Sniffed</th><th align="left">Keys Stolen</th><th align="left">Keys Lost</th></tr></thead><tbody><tr><td align="left">3</td><td align="left">0-2: normal rekey <br> 3: lock level increase to 4, normal rekey <br> 4: lock level increase to 5, normal rekey <br> 5: deadlocked</td><td align="left">0-2: normal rekey <br> 3-5: drained</td><td align="left">0-2: normal rekey <br> 3-4: slow rekey <br> 5: bricked</td></tr><tr><td align="left">4</td><td align="left">0-3: normal rekey <br> 4: lock level increase to 5, normal rekey <br> 5: deadlocked</td><td align="left">0-1: normal rekey <br> 2: slow rekey <br> 3-5: drained</td><td align="left">0-1: normal rekey <br> 2-4: slow rekey <br> 5: bricked</td></tr><tr><td align="left">5</td><td align="left">0-4: normal rekey <br> 5: deadlocked</td><td align="left">0: normal rekey <br> 1-2: slow rekey <br> 3-5: drained</td><td align="left">0: normal rekey <br> 1-4: slow rekey <br> 5: bricked</td></tr></tbody></table><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="source-code">Source Code<a href="#source-code" class="hash-link" aria-label="Source Code的直接链接" title="Source Code的直接链接">​</a></h2><p>The source code for the custody solution is in the <a href="https://github.com/Chia-Network/internal-custody" target="_blank" rel="noopener noreferrer" title="Chia internal custody solution">internal-custody GitHub repository</a>.</p><p>There are two configuration files, one public (for observers) and one private.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="public-configuration">Public Configuration<a href="#public-configuration" class="hash-link" aria-label="Public Configuration的直接链接" title="Public Configuration的直接链接">​</a></h3><p>An observer can track the prefarm&#x27;s configuration information from <a href="https://github.com/Chia-Network/internal-custody/blob/main/cic/drivers/prefarm_info.py#L8-L18" target="_blank" rel="noopener noreferrer" title="public configuration information">prefarm_info.py</a>, which contains the following variables:</p><ul><li><code>launcher_id</code>: <code>bytes32</code> -- This is pre-set; the user cannot change it</li><li><code>puzzle_root</code>: <code>bytes32</code> -- This is pre-set; the user cannot change it</li><li><code>withdrawal_timelock</code>: <code>uint64</code> -- For how long must the singleton remain unspent in order to initiate a withdrawal?</li><li><code>payment_clawback_period</code>: <code>uint64</code> -- How much time do signers have to claw back a payment?</li><li><code>rekey_clawback_period</code>: <code>uint64</code> -- How much time do signers have to claw back a rekey?</li><li><code>slow_rekey_timelock</code>: <code>uint64</code> -- What is the penalty P that is applied to the singleton timelock when initiating a slow rekey?</li><li><code>rekey_increments</code>: <code>uint64</code> -- What is the timelock increment for using fewer keys?</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="private-configuration">Private Configuration<a href="#private-configuration" class="hash-link" aria-label="Private Configuration的直接链接" title="Private Configuration的直接链接">​</a></h3><p>The necessary information to spend the prefarm is located in <a href="https://github.com/Chia-Network/internal-custody/blob/main/cic/drivers/puzzle_root_construction.py#L26-L34" target="_blank" rel="noopener noreferrer" title="private configuration information">puzzle_root_construction.py</a>. This information is considered private. However, if an attacker obtained this information, it would still be insufficient to spend the prefarm because valid signatures would be required. However, the Merkle tree would be considered sniffed, so a rekey would be required.</p><p>This code contains the following variables:</p><ul><li><code>prefarm_info</code>: <code>PrefarmInfo</code> -- The info from the public file</li><li><code>pubkey_list</code>: <code>List[G1Element]</code> -- What are the set of pubkeys?</li><li><code>required_pubkeys</code>: <code>uint32</code> -- How many keys are required for payments and standard rekeys (<code>m</code> initially is 3 for the prefarm)?</li><li><code>maximum_pubkeys</code>: <code>uint32</code> -- What is the maximum lock level (<code>n</code> is 5 for the prefarm)?</li><li><code>minimum_pubkeys</code>: <code>uint32</code> -- What is the minimum number of keys required for a slow rekey (1 for the prefarm, but could be higher if so desired).</li><li><code>next_root</code>: <code>Optional[bytes32]</code> -- What will the root key be in the event of a rekey?</li><li><code>filter_proofs</code>: <code>ProofType</code></li><li><code>leaf_proofs</code>: <code>ProofType</code></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/guides/custody/custody-tool-description.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/guides/cr-CAT-tutorial"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">CR-CAT Creation Tutorial</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/guides/custody-tool-user-guide"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Custody Tool User Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#singleton-structure" class="table-of-contents__link toc-highlight">Singleton Structure</a></li><li><a href="#singleton-settings" class="table-of-contents__link toc-highlight">Singleton Settings</a><ul><li><a href="#permanent-layer" class="table-of-contents__link toc-highlight">Permanent layer</a></li><li><a href="#non-permanent-layer" class="table-of-contents__link toc-highlight">Non-permanent layer</a></li></ul></li><li><a href="#allowed-actions" class="table-of-contents__link toc-highlight">Allowed Actions</a><ul><li><a href="#withdrawal" class="table-of-contents__link toc-highlight">Withdrawal</a></li><li><a href="#rekey" class="table-of-contents__link toc-highlight">Rekey</a></li><li><a href="#lock-level-increase" class="table-of-contents__link toc-highlight">Lock Level Increase</a></li><li><a href="#when-are-normal-rekey-slow-rekey-and-lock-level-increase-needed" class="table-of-contents__link toc-highlight">When are Normal Rekey, Slow Rekey and Lock Level Increase needed?</a></li></ul></li><li><a href="#source-code" class="table-of-contents__link toc-highlight">Source Code</a><ul><li><a href="#public-configuration" class="table-of-contents__link toc-highlight">Public Configuration</a></li><li><a href="#private-configuration" class="table-of-contents__link toc-highlight">Private Configuration</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://docs.chia.net/consensus-intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2023 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.668644d3.js"></script>
<script src="/zh/assets/js/main.a1d7c8f7.js"></script>
</body>
</html>
<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/crash-course/state">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">State | Chia Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" name="twitter:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" property="og:url" content="https://docs.chia.net/zh/guides/crash-course/state"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="State | Chia Documentation"><meta data-rh="true" name="description" content="Coin Set Refresher"><meta data-rh="true" property="og:description" content="Coin Set Refresher"><link data-rh="true" rel="icon" href="/zh/svg/chia-leaf-green.svg"><link data-rh="true" rel="canonical" href="https://docs.chia.net/zh/guides/crash-course/state"><link data-rh="true" rel="alternate" href="https://docs.chia.net/guides/crash-course/state" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.chia.net/zh/guides/crash-course/state" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.chia.net/guides/crash-course/state" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/js/matomo.js" async defer="defer"></script><link rel="stylesheet" href="/zh/assets/css/styles.f8fbe087.css">
<link rel="preload" href="/zh/assets/js/runtime~main.9351c532.js" as="script">
<link rel="preload" href="/zh/assets/js/main.ab471beb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/svg/chia-leaf-green.svg" alt="Chia Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Chia Docs</b></a><a class="navbar__item navbar__link" href="/zh/introduction">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/guides/crash-course/introduction">Guides</a><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chialisp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://chia.net" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Network<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Chia-Network/chia-blockchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/guides/crash-course/introduction">Crash Course</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/intro-to-chialisp">Chialisp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/smart-coins">Smart Coins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/signatures">Signatures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/guides/crash-course/state">State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/inner-puzzles">Inner Puzzles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/cats-offers-nfts">CATs, Offers and NFTs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/guides/crash-course/chialisp-and-typescript">Chialisp and TypeScript</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/chialisp-primer">Chialisp Primer</a><button aria-label="打开/收起侧边栏菜单「Chialisp Primer」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/chialisp-concepts">Chialisp Concepts</a><button aria-label="打开/收起侧边栏菜单「Chialisp Concepts」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/nft-developer-guide">NFT Guide</a><button aria-label="打开/收起侧边栏菜单「NFT Guide」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/zh/guides/cat-developer-guide">CAT Guide</a><button aria-label="打开/收起侧边栏菜单「CAT Guide」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/custody-tool-description">Custody Tool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/walletconnect-user-guide">WalletConnect</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/datalayer-user-guide">DataLayer™</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/clawback-user-guide">Clawback</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/simulator-user-guide">Simulator User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/seeder-user-guide">Seeder User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/guides/verifiable-credentials-guide">Verifiable Credentials Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/guides/why-chia-is-great-video-series">Tutorials</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Crash Course</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">State</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>State</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="coin-set-refresher">Coin Set Refresher<a href="#coin-set-refresher" class="hash-link" aria-label="Coin Set Refresher的直接链接" title="Coin Set Refresher的直接链接">​</a></h2><p>Before we jump in to the bulk of this lesson I wanted to remind you of how the Chia blockchain works. Chia uses a <strong>coin set</strong> model very similar to that of Bitcoin&#x27;s UTXO model. This is very different than the account model used in other major chains. Instead of having an account with a <em>balance</em>, you just have a collection of unspent coins that you are able to spend.</p><p>For example:</p><ul><li>Coin 1: 0.25 XCH</li><li>Coin 2: 1.75 XCH</li><li>Coin 3: 0.25 XCH</li><li>Coin 4: 1.75 XCH</li></ul><p>Balance: 4 XCH</p><p>You will often hear &quot;everything is a coin&quot; being said. This is true!</p><p>This introduces some unique approaches to creating software on the Chia blockchain.</p><p>To use Chialisp on the Chia blockchain, we must create a coin. As part of the coin set model, spending a coin results in a collection of removals and additions. The removals are your existing coins used for the spend being destroyed, and the additions are new coins (including any change) being created.</p><p>Here is an example</p><ol><li>Say you have 1.75 XCH</li><li>You send .75 XCH to some address (remember, an address is an encoded form of puzzle hash)</li><li>This results in all 1.75 of your XCH being spent</li><li>a new coin worth 1 XCH is created to be returned back to you (this is called change)</li><li>a new coin worth .75 XCH is created for the destination puzzle hash</li></ol><p>Another example:</p><ol><li>Say you have 2 XCH made up of multiple small coins</li><li>You send 1 XCH to some address</li><li>Coins of .1 XCH, .5 XCH, and .45 XCH are being spent to sum up to 1.05 XCH (greater than or equal to 1 XCH spend)</li><li>a new coin worth .05 XCH is created to be returned back to you</li><li>a new coin worth 1 XCH is created for the destination puzzle hash</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What&#x27;s Next?<a href="#whats-next" class="hash-link" aria-label="What&#x27;s Next?的直接链接" title="What&#x27;s Next?的直接链接">​</a></h2><p>We will be building a simple example of a coin that stores a message that anyone can change by spending the coin. This will be built using the previous lesson&#x27;s project setup, but you can find all of <code>index.ts</code> here:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>index.ts</summary><div><div class="collapsibleContent_i85q"><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> mnemonicToSeedSync </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;bip39&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> fromHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> PrivateKey</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> toHex </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-bls&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> Coin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> formatHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> FullNode</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> sanitizeHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> toCoinId </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-rpc&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> KeyStore</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> StandardWallet </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-wallet-lib&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> Program </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;clvm-lib&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> dotenv </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> fs </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> os </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;os&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> path </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;path&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">dotenv</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">config</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> mnemonic </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">MNEMONIC</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> privateKey </span><span class="token operator">=</span><span class="token plain"> PrivateKey</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromSeed</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">mnemonicToSeedSync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">mnemonic</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> dir </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">join</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">__dirname</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;..&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> messagePuzzle </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">deserializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    fs</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">readFileSync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">join</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;message.clsp.hex&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> node </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">FullNode</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">homedir</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;/.chia/mainnet&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> keyStore </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">KeyStore</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">privateKey</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> wallet </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">StandardWallet</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> keyStore</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> genesis </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">fromHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">GENESIS</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> amount </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> fee </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">0.00005e12</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">newInstance</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">initialMessage</span><span class="token operator">:</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">createSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Curry the puzzle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzle </span><span class="token operator">=</span><span class="token plain"> messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">curry</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Mod hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromBytes</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Message is empty until the eve is spent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">nil</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the eve coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> send </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">send</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> fee</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">...</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Calculate the root coin id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> eveCoin</span><span class="token operator">:</span><span class="token plain"> Coin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent_coin_info</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">formatHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_hash</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">formatHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hashHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        amount</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the eve solution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        initialMessage</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromInt</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend the eve coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coin</span><span class="token operator">:</span><span class="token plain"> eveCoin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_reveal</span><span class="token operator">:</span><span class="token plain"> puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        solution</span><span class="token operator">:</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Sign the wallet spend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">signSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> genesis</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Complete the transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Eve coin id:&#x27;</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">eveCoin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">pushTx</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">SyncInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    parent</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">string</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    current</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">string</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">Promise</span><span class="token operator">&lt;</span><span class="token plain">SyncInfo</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> eveCoinId </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">EVE_COIN_ID</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">let</span><span class="token plain"> current </span><span class="token operator">=</span><span class="token plain"> eveCoinId</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">let</span><span class="token plain"> parent </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token boolean" style="color:#B35C00;font-weight:normal">true</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Fetch coins created by the current coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordsByParentIds</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain">current</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token keyword" style="color:#990096">undefined</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token keyword" style="color:#990096">undefined</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token boolean" style="color:#B35C00;font-weight:normal">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// If there are none, we are already synced</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_records</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">break</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Update the parent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Continue with the child coin as the new singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_records</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        current </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        current</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token operator">:</span><span class="token plain"> SyncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">Promise</span><span class="token operator">&lt;</span><span class="token plain">Program</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordByName</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzleAndSolution </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getPuzzleAndSolution</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_record</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">spent_block_index</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_solution</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">deserializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token function" style="color:#0045DB">sanitizeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">solution</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">toList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">return</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">printMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> syncInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Message:&#x27;</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">toString</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">setMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">newMessage</span><span class="token operator">:</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> syncInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Fetch the coin record</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordByName</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coin </span><span class="token operator">=</span><span class="token plain"> coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_record</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">createSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the current puzzle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzle </span><span class="token operator">=</span><span class="token plain"> messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">curry</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromBytes</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        message</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the solution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        newMessage</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromInt</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend the current singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// The puzzle reveal contains the old message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_reveal</span><span class="token operator">:</span><span class="token plain"> puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend it with the new message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        solution</span><span class="token operator">:</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> send </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sendFee</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">fee</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">...</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">signSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> genesis</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">pushTx</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token comment" style="color:#73737D;font-weight:normal">// newInstance(Program.fromText(&#x27;Hello, world!&#x27;));</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token comment" style="color:#73737D;font-weight:normal">// printMessage();</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token comment" style="color:#73737D;font-weight:normal">// setMessage(Program.fromText(&#x27;Goodbye, world!&#x27;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-in-chialisp">State in Chialisp<a href="#state-in-chialisp" class="hash-link" aria-label="State in Chialisp的直接链接" title="State in Chialisp的直接链接">​</a></h2><p>We are now going to be discussing the idea of state. State is used to maintain some value on-chain. This can be done with a coin that recreates itself currying in a new value.</p><p>The example we will be using today stores a message that can be changed by anyone. Essentially, the first coin we create will store the initial state, which is the message. Then, every time the coin is spent, we will create a new coin that stores the new message inside of it.</p><p>The first coin is called the <strong>eve</strong>, and every coin that follows it forms a complete lineage of the history.</p><p>First, we will install the needed Chialisp dependencies:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cdv clsp retrieve condition_codes curry_and_treehash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is the puzzle we will be using:</p><div class="language-chialisp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockTitle_Ktv7">message.clsp</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-chialisp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">(mod (MOD_HASH MESSAGE new_message amount)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (include condition_codes.clib)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (include curry_and_treehash.clib)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (defun-inline new_puzzle_hash (MOD_HASH new_message)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (puzzle-hash-of-curried-function MOD_HASH</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (sha256 1 new_message)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            (sha256 1 MOD_HASH)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    (list</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        (list CREATE_COIN (new_puzzle_hash MOD_HASH new_message) amount)</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Specifically, this will create a new coin using <code>CREATE_COIN</code>. The puzzle hash is calculated by passing <code>MOD_HASH</code> and <code>new_message</code> to the <code>new_puzzle_hash</code> function. This effectively recreates the coin with the same puzzle. The only difference is that is uses the new message.</p><p>We will compile this Chialisp code with this command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">cdv clsp build message.clsp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-setup">Initial Setup<a href="#initial-setup" class="hash-link" aria-label="Initial Setup的直接链接" title="Initial Setup的直接链接">​</a></h2><p>Install the needed dependencies:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token function" style="color:#0045DB">npm</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">install</span><span class="token plain"> bip39 chia-bls chia-rpc chia-wallet-lib clvm-lib dotenv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the code to set everything up and prepare for building this example:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> mnemonicToSeedSync </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;bip39&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> fromHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> PrivateKey</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> toHex </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-bls&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> Coin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> formatHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> FullNode</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> sanitizeHex</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> toCoinId </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-rpc&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> KeyStore</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> StandardWallet </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;chia-wallet-lib&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"> Program </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;clvm-lib&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> dotenv </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;dotenv&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> fs </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;fs&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> os </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;os&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">import</span><span class="token plain"> path </span><span class="token keyword" style="color:#990096">from</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;path&#x27;</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">dotenv</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">config</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> mnemonic </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">MNEMONIC</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> privateKey </span><span class="token operator">=</span><span class="token plain"> PrivateKey</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromSeed</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">mnemonicToSeedSync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">mnemonic</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> dir </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">join</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">\_\_dirname</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;..&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> messagePuzzle </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">deserializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">fs</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">readFileSync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">join</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">dir</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;message.clsp.hex&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;utf-8&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> node </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">FullNode</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">homedir</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;/.chia/mainnet&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> keyStore </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">KeyStore</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">privateKey</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> wallet </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">StandardWallet</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> keyStore</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> genesis </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">fromHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">GENESIS</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> amount </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">1</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> fee </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number" style="color:#B35C00;font-weight:normal">0.00005e12</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initializing-the-coin">Initializing the Coin<a href="#initializing-the-coin" class="hash-link" aria-label="Initializing the Coin的直接链接" title="Initializing the Coin的直接链接">​</a></h2><p>The first thing that we need to do is create the eve coin. However, that is not enough to be able to fetch the message that is stored on-chain. This is because the puzzle that a coin uses is not revealed until that coin is spent.</p><p>The solution to this problem is to instantly spend the eve coin when it is created. This way, the solution will contain the message that the next coin uses. This allows the current state to be inferred and the coin to be spent later by someone else.</p><p>Here is the code that initializes the eve coin and its descendant:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">newInstance</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">initialMessage</span><span class="token operator">:</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">createSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Curry the puzzle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzle </span><span class="token operator">=</span><span class="token plain"> messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">curry</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Mod hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromBytes</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Message is empty until the eve is spent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">nil</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the eve coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> send </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">send</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> fee</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">...</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Calculate the root coin id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> eveCoin</span><span class="token operator">:</span><span class="token plain"> Coin </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent_coin_info</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">formatHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_hash</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">formatHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hashHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        amount</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the eve solution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        initialMessage</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromInt</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend the eve coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coin</span><span class="token operator">:</span><span class="token plain"> eveCoin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_reveal</span><span class="token operator">:</span><span class="token plain"> puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        solution</span><span class="token operator">:</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Sign the wallet spend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">signSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> genesis</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Complete the transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Eve coin id:&#x27;</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">eveCoin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">pushTx</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token function" style="color:#0045DB">newInstance</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromText</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Hello, world!&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running this, you will get a response similar to:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Eve coin id: a6c5a4d12456ae6dee553b1b17544799f561a62f678d7948df12f28d17bfa96e</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">{ status: &#x27;SUCCESS&#x27;, success: true }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where the eve coin ID is the ID of the first coin.</p><p>We have successfully created the eve coin, spent it to reveal the current state (the message), and logged the eve coin ID.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="retrieving-the-message">Retrieving the Message<a href="#retrieving-the-message" class="hash-link" aria-label="Retrieving the Message的直接链接" title="Retrieving the Message的直接链接">​</a></h2><p>We can retrieve the message by getting the eve coin and following its children to the latest (referred to as syncing). The most recent message is provided in the solution of the spend of the previous coin.</p><p>For this to work, we read the <code>EVE_COIN_ID</code> from the <code>.env</code> file, which should now look something like:</p><div class="language-env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockTitle_Ktv7">.env</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-env codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">MNEMONIC=nasty sunny kingdom popular turn core rifle river twenty edit sort pill rice claw hollow please wash inform cannon empower emotion caught salt close</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">GENESIS=d25b25b897564035695996922aa0f9ff9d611bd38cd2ecd0d2383a99a70dfc15</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">EVE_COIN_ID=5fe284bfa91c32fd274179769f5b808c916e5135e603cb292a90e04e5867bd1a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Write the following code to sync the state:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockTitle_Ktv7">index.ts</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">SyncInfo</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    parent</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">string</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    current</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">string</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">Promise</span><span class="token operator">&lt;</span><span class="token plain">SyncInfo</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> eveCoinId </span><span class="token operator">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#383a42">.</span><span class="token constant">EVE_COIN_ID</span><span class="token operator">!</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">let</span><span class="token plain"> current </span><span class="token operator">=</span><span class="token plain"> eveCoinId</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">let</span><span class="token plain"> parent </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token boolean" style="color:#B35C00;font-weight:normal">true</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Fetch coins created by the current coin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecords </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordsByParentIds</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain">current</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token keyword" style="color:#990096">undefined</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token keyword" style="color:#990096">undefined</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">            </span><span class="token boolean" style="color:#B35C00;font-weight:normal">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// If there are none, we are already synced</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_records</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">length</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">break</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Update the parent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Continue with the child coin as the new singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> coinRecords</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_records</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        current </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">toHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token function" style="color:#0045DB">toCoinId</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        parent</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        current</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now that we have the current coin and its parent, we can fetch the solution of the parent&#x27;s spend to find the message:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token operator">:</span><span class="token plain"> SyncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:#127EAF">Promise</span><span class="token operator">&lt;</span><span class="token plain">Program</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordByName</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzleAndSolution </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getPuzzleAndSolution</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">parent</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_record</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">spent_block_index</span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> puzzleAndSolution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_solution</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">deserializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token function" style="color:#0045DB">sanitizeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">solution</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">toList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">return</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">[</span><span class="token number" style="color:#B35C00;font-weight:normal">0</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">printMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> syncInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Message:&#x27;</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">toString</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token function" style="color:#0045DB">printMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running this with <code>npm run start</code> should output the initial message:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">Message: &quot;Hello, world!&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="updating-the-message">Updating the Message<a href="#updating-the-message" class="hash-link" aria-label="Updating the Message的直接链接" title="Updating the Message的直接链接">​</a></h2><p>Finally, we can create a new coin by spending the existing coin and providing a new message in the solution.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">async</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">function</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">setMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">newMessage</span><span class="token operator">:</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> syncInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Fetch the coin record</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordByName</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coin </span><span class="token operator">=</span><span class="token plain"> coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_record</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> spend </span><span class="token operator">=</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">createSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the current puzzle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> puzzle </span><span class="token operator">=</span><span class="token plain"> messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">curry</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromBytes</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">messagePuzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">hash</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        message</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Create the solution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        newMessage</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromInt</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend the current singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        coin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// The puzzle reveal contains the old message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        puzzle_reveal</span><span class="token operator">:</span><span class="token plain"> puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend it with the new message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">        solution</span><span class="token operator">:</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> send </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sendFee</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">fee</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">...</span><span class="token plain">send</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">signSpend</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> genesis</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token builtin" style="color:#127EAF">console</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">log</span><span class="token punctuation" style="color:#383a42">(</span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">pushTx</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token function" style="color:#0045DB">setMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromText</span><span class="token punctuation" style="color:#383a42">(</span><span class="token string" style="color:#B35C00;font-weight:normal">&#x27;Goodbye, world!&#x27;</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the following command to set the new message:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token function" style="color:#0045DB">npm</span><span class="token plain"> run start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="breakdown">Breakdown<a href="#breakdown" class="hash-link" aria-label="Breakdown的直接链接" title="Breakdown的直接链接">​</a></h3><p>This will first find the latest coin from the eve coin ID:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token keyword" style="color:#990096">await</span><span class="token plain"> wallet</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> syncInfo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">sync</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> message </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> </span><span class="token function" style="color:#0045DB">getMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token comment" style="color:#73737D;font-weight:normal">// Fetch the coin record</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coinRecord </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">await</span><span class="token plain"> node</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">getCoinRecordByName</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">syncInfo</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">current</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#383a42">(</span><span class="token operator">!</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#383a42">)</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#990096">new</span><span class="token plain"> </span><span class="token class-name" style="color:#006100">Error</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> coin </span><span class="token operator">=</span><span class="token plain"> coinRecord</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_record</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which is then spent using a solution with our new message:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token comment" style="color:#73737D;font-weight:normal">// Create the solution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token keyword" style="color:#990096">const</span><span class="token plain"> solution </span><span class="token operator">=</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromList</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">[</span><span class="token plain">newMessage</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"> Program</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">fromInt</span><span class="token punctuation" style="color:#383a42">(</span><span class="token plain">coin</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">]</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">spend</span><span class="token punctuation" style="color:#383a42">.</span><span class="token plain">coin_spends</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">push</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend the current singleton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    coin</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// The puzzle reveal contains the old message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    puzzle_reveal</span><span class="token operator">:</span><span class="token plain"> puzzle</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    </span><span class="token comment" style="color:#73737D;font-weight:normal">// Spend it with the new message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain">    solution</span><span class="token operator">:</span><span class="token plain"> solution</span><span class="token punctuation" style="color:#383a42">.</span><span class="token function" style="color:#0045DB">serializeHex</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token plain"></span><span class="token punctuation" style="color:#383a42">}</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updated-message">Updated Message<a href="#updated-message" class="hash-link" aria-label="Updated Message的直接链接" title="Updated Message的直接链接">​</a></h3><p>Now, we should be able to retrieve the new message with:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token function" style="color:#0045DB">printMessage</span><span class="token punctuation" style="color:#383a42">(</span><span class="token punctuation" style="color:#383a42">)</span><span class="token punctuation" style="color:#383a42">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Run the following command to see the new message:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#383a42;--prism-background-color:#fafafa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#383a42;font-weight:bold"><span class="token function" style="color:#0045DB">npm</span><span class="token plain"> run start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_S0QG"><p>As a reminder, each step can take some time as the message is updated on chain. Because of this, you&#x27;ll want to issue each function call separately.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shared-messages">Shared Messages<a href="#shared-messages" class="hash-link" aria-label="Shared Messages的直接链接" title="Shared Messages的直接链接">​</a></h2><p>Because this puzzle does not require a signature, anyone can spend the coin providing a new message.
Say your eve coin ID is <code>5fe284bfa91c32fd274179769f5b808c916e5135e603cb292a90e04e5867bd1a</code>, you can share this value with anyone to update this message.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Conclusion的直接链接" title="Conclusion的直接链接">​</a></h2><p>This has been an introduction to managing to state on the Chia blockchain. We&#x27;ve seen how you can write a puzzle that recreates itself with new values in order to maintain a complete linear history of updates on-chain. You can find the current value by looking at the solution of the last coin&#x27;s parent.</p><p>In the world of Chia, this concept is used heavily to store various information. For example, NFTs maintain a list of URIs that point to the data, metadata, and license.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>More Info: Singletons</summary><div><div class="collapsibleContent_i85q"><p>A singleton is a common application of the &quot;recreate self&quot; functionality we used in this lesson. Essentially, a singleton can be used to wrap an inner puzzle and add additional rules to it. In particular, it ensures that only one output is created (with an odd amount). Every time the coin is spent, the output of the inner puzzle is wrapped to maintain the singleton&#x27;s lineage. This restriction can only be broken by melting the singleton.</p><p>Anyone can create a coin with any puzzle. This means there is a good chance there will be multiple coins with the same puzzle hash. This can lead to confusion as to which coin is which, and may lead to confusion or mistakes. A singleton allows for something to exist on chain that is provably unique. This helps us be sure that we are working with the correct coin.</p><p>The idea is that you can reuse the singleton behavior without having to write everything in a special way. You can <a href="https://chialisp.com/singletons" target="_blank" rel="noopener noreferrer">read more about singletons</a> if you want to, but we will not be covering them in this course due to the additional complexities involved in launching and spending them.</p><p>Often times, puzzles that manage state will be wrapped in the singleton to ensure that there is only one instance of the state at a given time. It would be as simple as using the puzzle we wrote in this lesson as the inner puzzle to a singleton. The only additional restriction is that the coin&#x27;s amount must be odd.</p><p>Because the singleton will be a series of spent coins and new coins created over time, we need a different way than the coin ID to identify a singleton. A singleton is instead identified by its <strong>launcher ID</strong>, which is the coin ID of the singleton&#x27;s parent coin (think of this as similar to the eve coin ID we created in this lesson). This parent coin is the coin used to create the initial coin of the singleton.</p></div></div></details></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/guides/crash-course/state.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/guides/crash-course/signatures"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Signatures</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/guides/crash-course/inner-puzzles"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Inner Puzzles</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#coin-set-refresher" class="table-of-contents__link toc-highlight">Coin Set Refresher</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s Next?</a></li><li><a href="#state-in-chialisp" class="table-of-contents__link toc-highlight">State in Chialisp</a></li><li><a href="#initial-setup" class="table-of-contents__link toc-highlight">Initial Setup</a></li><li><a href="#initializing-the-coin" class="table-of-contents__link toc-highlight">Initializing the Coin</a></li><li><a href="#retrieving-the-message" class="table-of-contents__link toc-highlight">Retrieving the Message</a></li><li><a href="#updating-the-message" class="table-of-contents__link toc-highlight">Updating the Message</a><ul><li><a href="#breakdown" class="table-of-contents__link toc-highlight">Breakdown</a></li><li><a href="#updated-message" class="table-of-contents__link toc-highlight">Updated Message</a></li></ul></li><li><a href="#shared-messages" class="table-of-contents__link toc-highlight">Shared Messages</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://docs.chia.net/consensus-intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants</a></li><li class="footer__item"><a href="https://chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2023 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.9351c532.js"></script>
<script src="/zh/assets/js/main.ab471beb.js"></script>
</body>
</html>
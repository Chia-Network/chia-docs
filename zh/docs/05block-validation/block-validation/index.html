<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-05block-validation/block-validation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6HSSLLPE6Q"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6HSSLLPE6Q",{anonymize_ip:!0})</script><title data-rh="true">5.1 Block Validation | Chia Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" name="twitter:image" content="https://docs.chia.net/zh/img/og-chia.png"><meta data-rh="true" property="og:url" content="https://docs.chia.net/zh/docs/05block-validation/block-validation"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="5.1 Block Validation | Chia Documentation"><meta data-rh="true" name="description" content="Block validation in Chia is composed of two parts: header validation and body validation."><meta data-rh="true" property="og:description" content="Block validation in Chia is composed of two parts: header validation and body validation."><link data-rh="true" rel="icon" href="/zh/img/chia_leaf_green.svg"><link data-rh="true" rel="canonical" href="https://docs.chia.net/zh/docs/05block-validation/block-validation"><link data-rh="true" rel="alternate" href="https://docs.chia.net/docs/05block-validation/block-validation" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.chia.net/zh/docs/05block-validation/block-validation" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.chia.net/docs/05block-validation/block-validation" hreflang="x-default"><link rel="stylesheet" href="/zh/assets/css/styles.ba4f6583.css">
<link rel="preload" href="/zh/assets/js/runtime~main.2e361673.js" as="script">
<link rel="preload" href="/zh/assets/js/main.2ab960e1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><div class="announcementBar_mb4j" style="background-color:#0d3349;color:#fff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="announcementBarContent_xLdY">CAT2 Standard Released üå±<a target="_blank" rel="noopener noreferrer" href="/docs/cat2/cat2-intro/"> Learn about CAT1 end-of-life and CAT2 reissuance</a></div><button type="button" class="clean-btn close announcementBarClose_gvF7" aria-label="ÂÖ≥Èó≠"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/chia_leaf_green.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/chia_leaf_green.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"> Chia Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh/docs/01introduction/what-is-chia">Docs</a><a href="https://www.chia.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia.net</a><a href="https://github.com/Chia-Network/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chia Github</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>‰∏≠Êñá</a><ul class="dropdown__menu"><li><a href="/docs/05block-validation/block-validation" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh/docs/05block-validation/block-validation" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">‰∏≠Êñá</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫ÊµÖËâ≤Ê®°ÂºèÔºâ"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="ÂõûÂà∞È°∂ÈÉ®" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/cat2/cat2-intro">CAT2 Upgrade Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/01introduction/what-is-chia">1 - Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/02architecture/p2p-system">2 - Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/03consensus/consensus_intro">3 - Consensus Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/04coin-set-model/intro">4 - Coin Set Model</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/docs/05block-validation/block-validation">5 - Block Validation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/docs/05block-validation/block-validation">5.1 Block Validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/05block-validation/block_format">5.2 Block format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/docs/05block-validation/block_rewards">5.3 Block rewards</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/06mempool/mempool">6 - Mempool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/07networking/networking">7 - Networking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/08serialization/serialization">8 - Serialization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/09keys/keys-and-signatures">9 - Keys and Signatures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/10protocol/protocol">10 - Protocol</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/11pooling/pooling">11 - Pool Protocol</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/12rpcs/rpcs">12 - RPC APIs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/13cli/cli">13 - Command Line Interface</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/14python-implementation/python-implementation">14 - Python Implementation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/docs/15resources/references">15 - Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="È°µÈù¢Ë∑ØÂæÑ"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="‰∏ªÈ°µÈù¢" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">5 - Block Validation</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">5.1 Block Validation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Êú¨È°µÊÄªËßà</button></div><div class="theme-doc-markdown markdown"><h1>5.1 Block Validation</h1><p>Block validation in Chia is composed of two parts: header validation and body validation.</p><p>The header validation performs consensus algorithm-related checks, such as proof of space and time, signage points and infusion points, previous block hashes, foliage hashes, and timestamps. Notably, it does not validate any CLVM, coin spends, or signatures. Usually, for efficiency, light clients will want to validate headers but not the body.</p><p>Body validation entails running all puzzles for spent coins, reading the coin database, verifying signatures, checking for duplicate or invalid removals and additions, etc.</p><p>Validating a block in Chia will require access to some blocks in the past, up to a maximum theoretical value of three times the max number of blocks in a slot (3x128=384), but usually only a few are needed. Also, information regarding previous sub-epochs and epochs is needed for validation, as well as the current system timestamp. Implementations
can cache only some recent blocks instead of storing all blocks in memory. <code>chia-blockchain</code> maintains a database of BlockRecords, which contain only the important pieces of block information required for validating future blocks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="full-sync-vs-normal-operation">Full Sync vs Normal Operation<a class="hash-link" href="#full-sync-vs-normal-operation" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>There are two cases when a node might verify blocks.</p><ol><li>During a full sync, where the node is trying to catch up to the most recent block, starting from an old block height. In this case, the node is able to download many blocks at once.</li><li>During normal operation, where the node is caught up to the most recent block, and is only downloading one block every few seconds.</li></ol><p>We&#x27;ll cover both of these cases below.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="full-sync">Full Sync<a class="hash-link" href="#full-sync" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>Full sync is the process by which a full node downloads and validates all of the blocks in the blockchain and catches up to the most recent block. Full sync is important, because it allows new nodes to validate that a blockchain is the heaviest -- and thus, the currently valid -- chain. It allows everyone to come to consensus on the current state, regardless of when they come online, or for how long they go offline.</p><p>The method of full sync can vary between implementations, but the high level algorithm is the following:</p><ol><li>Connect to other peers on the network, by querying the DNS introducer, and crawling the network.</li><li>Check the current weight of the peak of the peers, and select a few peers to sync from.</li><li>Download and validate a weight proof, to ensure that the given peak has real work behind it.</li><li>Download and validate all blocks in the blockchain, in batches.</li></ol><p>Weight proofs are important, because they prevent other peers from lying to us about what the heaviest peak is. They also prevent us from downloading potentially useless data. Once the full node is caught up to the blockchain, it can properly farm, access the coin state, etc.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="normal-operation">Normal Operation<a class="hash-link" href="#normal-operation" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><p>Normal operation is the process by which a full node continuously gossips and receives blocks with other peers, always following the heaviest peak. If our node is at weight 2000, and we see that a peer has a peak at weight 2100, then we fetch that block from the peer. Usually, this is done in two phases:</p><ol><li>The unfinished block is propagated across the network, along with all information up to the signage point, transactions, etc.</li><li>The finished block, which includes infusion point VDFs, is also propagated. This typically excludes the transactions, which were already sent in step 1.</li></ol><p>Normal operation is much less CPU-intensive than full sync, since there is only one block every 18 seconds, and one transaction block every 52 seconds, on average. Low-power machines like the Raspberry PI 4 should be able to easily continue normal operation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="block-validation-steps">Block Validation Steps<a class="hash-link" href="#block-validation-steps" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2><p>The following sections list all of the required checks to ensure validity of a block. Please note that the official protocol and specification are defined by the <code>chia-blockchain</code>
<a href="https://github.com/Chia-Network/chia-blockchain/tree/main/chia/consensus" target="_blank" rel="noopener noreferrer">Python implementation</a>, and NOT by this documentation page.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="header-validation">Header Validation<a class="hash-link" href="#header-validation" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><ol><li>Check that the previous block exists in the blockchain, or that it is genesis.</li><li>Check finished slots that have been crossed since <code>prev_b</code>= the previous block in the chain.<ul><li>Check sub-slot challenge hash for genesis block.</li><li>Check sub-slot challenge hash for non-genesis block.</li><li>Check sub-slot challenge hash for empty slot.</li><li>Validate that genesis block has no ICC=Infused challenge chain.</li><li>Validate that there is not icc iff icc_challenge hash is None.</li><li>Check infused challenge chain sub-slot VDF.</li><li>Check infused challenge sub-slot hash in challenge chain, deficit 16.</li><li>Check infused challenge sub-slot hash not included for other deficits.</li><li>Check infused challenge sub-slot hash in reward sub-slot.</li><li>If no icc, check that the cc=challenge chain doesn&#x27;t include it.</li><li>If no icc, check that the rc=reward chain doesn&#x27;t include it.</li><li>Check sub-epoch summary hash is None for empty slots.</li><li>Check new difficulty and ssi if applicable.</li><li>Check new difficulty and ssi are None if we don&#x27;t finish epoch.</li><li>Check challenge sub-slot hash in reward sub-slot.</li><li>Check end of reward slot VDF.</li><li>Check challenge chain sub-slot VDF.</li><li>Check deficit (MIN_SUB.. deficit edge case for genesis block)</li><li>If prev sb had deficit 0, resets deficit to MIN_BLOCK_PER_CHALLENGE_BLOCK</li><li>Otherwise, deficit stays the same at the slot ends, cannot reset until 0</li></ul></li><li>Check sub-epoch summary<ul><li>Check that genesis block does not have sub-epoch summary</li><li>Check that we finished a slot and we finished a sub-epoch</li><li>Check the actual sub-epoch is correct</li><li>Check that we don&#x27;t have to include a sub-epoch summary</li></ul></li><li>Check if the number of blocks is less than the max</li><li>Check proof of space</li><li>Check signage point index</li><li>Check required iters</li><li>check signage point index 0 has no cc sp and no rc sp</li><li>Check no overflows in the first sub-slot of a new epoch</li><li>Check total iters</li><li>Check reward chain sp proof</li><li>Check reward chain sp signature</li><li>Check cc sp vdf</li><li>Check cc sp sig</li><li>Check is_transaction_block</li><li>Check foliage block signature by plot key</li><li>Check foliage block signature by plot key</li><li>Check unfinished reward chain block hash</li><li>Check pool target max height</li><li>Check pre-farm puzzle hashes for genesis block.<ul><li>If pospace has a pool pk, check pool target signature. Should not check this for genesis block.</li><li>Otherwise, the plot is associated with a contract puzzle hash, not a public key, so check pool contract ph</li></ul></li><li>Check extension data if applicable. None for mainnet.</li><li>Check if foliage block is present</li><li>Check foliage block hash</li><li>Check prev block hash for genesis and non-genesis</li><li>The filter hash in the Foliage Block must be the hash of the filter</li><li>The timestamp in Foliage Block must not be over 5 minutes in the future, and the timestamp must be greater than the previous transaction block timestamp</li><li>Check block height for genesis and non-genesis</li><li>Check block weight for genesis and non-genesis</li><li>Check challenge chain infusion point VDF</li><li>Check reward chain infusion point VDF</li><li>Check infused challenge chain infusion point VDF</li><li>Check reward block hash</li><li>Check reward block is_transaction_block</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="body-validation">Body Validation<a class="hash-link" href="#body-validation" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h3><ol><li>For non transaction-blocs: foliage block, transaction filter, transactions info, and generator must
be empty. If it is a block but not a transaction block, there is no body to validate. Check that all fields are
None, and return.</li><li>For blocks, foliage block, transactions info must not be empty.</li><li>The transaction info hash in the Foliage block must match the transaction info.</li><li>The foliage block hash in the foliage block must match the foliage block.</li><li>The reward claims must be valid for the previous blocks, and current block fees.</li><li>No transactions before INITIAL_TRANSACTION_FREEZE timestamp (this check has been removed).</li><li>The generator root must be the hash of the serialized bytes of the generator for this block (or zeroes if no generator)</li><li>Check the transactions generator reference list:<ul><li>The generator_ref_list must be the hash of the serialized bytes of</li><li>the generator ref list for this block (or &#x27;one&#x27; bytes <!-- -->[0x01]<!-- --> if no generator)</li><li>The generator ref list length must be less than or equal to MAX_GENERATOR_REF_LIST_SIZE entries</li><li>The generator ref list must not point to a height &gt;= this block&#x27;s height</li><li>If we have a generator reference list, we must have a generator</li><li>Check that cost &lt;= MAX_BLOCK_COST_CLVM</li><li>The CLVM program must not return any errors</li></ul></li><li>Check that the correct cost is in the transactions info</li><li>Check additions for max coin amount (be careful to check for 64 bit overflows in other languages. This is the max 64 bit unsigned integer)</li><li>Validate addition and removal merkle set roots.</li><li>The additions and removals must result in the correct filter.</li><li>Check for duplicate outputs in additions.</li><li>Check for duplicate spends inside block.</li><li>Check if removals exist and were not previously spent. (coin_db up to the fork point + fork block + this_block).
Be careful with forks and with ephemeral coins (added and removed in same block).</li><li>Check that the total coin amount for added is &lt;= removed.</li><li>Check that the assert fee sum &lt;= fees, and that each reserved fee is non-negative.</li><li>Check that the fee amount + farmer reward &lt; maximum coin amount.</li><li>Check that the computed fees are equal to the fees in the block header.</li><li>Verify that removed coin puzzle_hashes match with calculated puzzle_hashes.</li><li>Verify CLVM conditions.</li><li>Verify aggregated signature.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Chia-Network/chia-docs/blob/main/docs/05block-validation/block-validation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ÁºñËæëÊ≠§È°µ</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ÊñáÊ°£ÂàÜÈ°µÂØºËà™"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/docs/04coin-set-model/clvm_vs_evm"><div class="pagination-nav__sublabel">‰∏ä‰∏ÄÈ°µ</div><div class="pagination-nav__label">4.8 CLVM vs EVM</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/docs/05block-validation/block_format"><div class="pagination-nav__sublabel">‰∏ã‰∏ÄÈ°µ</div><div class="pagination-nav__label">5.2 Block format</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#full-sync-vs-normal-operation" class="table-of-contents__link toc-highlight">Full Sync vs Normal Operation</a><ul><li><a href="#full-sync" class="table-of-contents__link toc-highlight">Full Sync</a></li><li><a href="#normal-operation" class="table-of-contents__link toc-highlight">Normal Operation</a></li></ul></li><li><a href="#block-validation-steps" class="table-of-contents__link toc-highlight">Block Validation Steps</a><ul><li><a href="#header-validation" class="table-of-contents__link toc-highlight">Header Validation</a></li><li><a href="#body-validation" class="table-of-contents__link toc-highlight">Body Validation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Approach</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.chia.net/approach" target="_blank" rel="noopener noreferrer" class="footer__link-item">White Paper</a></li></ul></div><div class="col footer__col"><div class="footer__title">Technology</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.chia.net/greenpaper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Green Paper</a></li><li class="footer__item"><a href="https://www.chia.net/assets/Chia-New-Consensus-0.9.pdf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Consensus 1.1</a></li></ul></div><div class="col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.chia.net/grants" target="_blank" rel="noopener noreferrer" class="footer__link-item">Grants</a></li><li class="footer__item"><a href="https://www.chialisp.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chialisp</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://chia.net/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://chia.net/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://chia.net/contact" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2022 Chia Network Inc., Licensed under the <a href="https://github.com/Chia-Network/chia-docs/blob/main/LICENSE" target="_blank">Apache License, Version 2.0</a> | <a href="https://www.chia.net/terms">Terms</a></div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.2e361673.js"></script>
<script src="/zh/assets/js/main.2ab960e1.js"></script>
</body>
</html>